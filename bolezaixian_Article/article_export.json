[{"title": "du 及 df 命令的使用（附带示例）", "create_date": "2018/03/23 ·", "url": "http://blog.jobbole.com/113780/", "front_image": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "like": 1, "comment": 0, "collect": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://linuxtechlab.com/du-df-commands-examples/\">shusain</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9457-1.html\">Linux中国/geekpi</a>   </div><p>在本文中，我将讨论 <code>du</code> 和 <code>df</code> 命令。<code>du</code> 和 <code>df</code> 命令都是 Linux 系统的重要工具，来显示 Linux 文件系统的磁盘使用情况。这里我们将通过一些例子来分享这两个命令的用法。</p>\n<ul>\n<li><strong>（推荐阅读：<a href=\"http://linuxtechlab.com/files-transfer-scp-rsync-commands/\">使用 scp 和 rsync 命令传输文件</a>）</strong></li>\n<li><strong>（另请阅读：<a href=\"http://linuxtechlab.com/linux-cloning-disks-using-dd-cat-commands/\">使用 dd 和 cat 命令为 Linux 系统克隆磁盘</a>）</strong></li>\n</ul>\n<h3 id=\"toc_1\">du 命令</h3>\n<p><code>du</code>（disk usage 的简称）是用于查找文件和目录的磁盘使用情况的命令。<code>du</code> 命令在与各种选项一起使用时能以多种格式提供结果。</p>\n<p>下面是一些例子：</p>\n<h4 id=\"toc_2\">1、 得到一个目录下所有子目录的磁盘使用概况</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac14b7ec8c0a634517318\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ du /home\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac14b7ec8c0a634517318-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14b7ec8c0a634517318-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac14b7ec8c0a634517318-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">du</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">home</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14b7ec8c0a634517318-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/a7080196ba5d69aefcecf7bbf44c9556.jpg\" alt=\"du command\"></p>\n<p>该命令的输出将显示 <code>/home</code> 中的所有文件和目录以及显示块大小。</p>\n<h4 id=\"toc_3\">2、 以人类可读格式也就是 kb、mb 等显示文件/目录大小</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac14b7ec8c16286923992\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ du -h /home\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac14b7ec8c16286923992-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14b7ec8c16286923992-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac14b7ec8c16286923992-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">du</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">home</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14b7ec8c16286923992-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/1b9dd42d7efa627e663eeb719c31051b.jpg\" alt=\"du command\"></p>\n<h4 id=\"toc_4\">3、 目录的总磁盘大小</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac14b7ec8c1a426155918\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ du -s /home\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac14b7ec8c1a426155918-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14b7ec8c1a426155918-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac14b7ec8c1a426155918-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">du</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">home</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14b7ec8c1a426155918-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/3d49dd172fc018cabd4747f4db263811.jpg\" alt=\"du command\"></p>\n<p>它是 <code>/home</code> 目录的总大小</p>\n<h3 id=\"toc_5\">df 命令</h3>\n<p>df（disk filesystem 的简称）用于显示 Linux 系统的磁盘利用率。（LCTT 译注：<code>df</code> 可能应该是 disk free 的简称。）</p>\n<p>下面是一些例子。</p>\n<h4 id=\"toc_6\">1、 显示设备名称、总块数、总磁盘空间、已用磁盘空间、可用磁盘空间和文件系统上的挂载点。</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac14b7ec8c1e598345732\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ df\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac14b7ec8c1e598345732-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14b7ec8c1e598345732-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac14b7ec8c1e598345732-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">df</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14b7ec8c1e598345732-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/ab5724c46d3e98a63c869827c65cd227.jpg\" alt=\"df command\"></p>\n<h4 id=\"toc_7\">2、 人类可读格式的信息</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac14b7ec8c22676206177\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ df -h\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac14b7ec8c22676206177-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14b7ec8c22676206177-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac14b7ec8c22676206177-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">df</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14b7ec8c22676206177-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/5e54bd24a629aad15d72114b57687e18.jpg\" alt=\"df command\"></p>\n<p>上面的命令以人类可读格式显示信息。</p>\n<h4 id=\"toc_8\">3、 显示特定分区的信息</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac14b7ec8c25557426967\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ df -hT /etc\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac14b7ec8c25557426967-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14b7ec8c25557426967-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac14b7ec8c25557426967-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">df</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">hT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">etc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14b7ec8c25557426967-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/5b29e87fdba47b650c6958d569d553c2.jpg\" alt=\"df command\"></p>\n<p><code>-hT</code> 加上目标目录将以可读格式显示 <code>/etc</code> 的信息。</p>\n<p>虽然 <code>du</code> 和 <code>df</code> 命令有更多选项，但是这些例子可以让你初步了解。如果在这里找不到你要找的东西，那么你可以参考有关命令的 man 页面。</p>\n<p>另外，<a href=\"http://linuxtechlab.com/tips-tricks/\"><strong>在这</strong></a>阅读我的其他帖子，在那里我分享了一些其他重要和经常使用的 Linux 命令。</p>\n<p>如往常一样，欢迎你留下评论和疑问，因此在下面留下你的评论和疑问，我会回复你。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113780\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113780votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113780\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "9f16c4dc5a6cd2f4b07fef3690f49f8b"},{"title": "Linux 中的“大内存页”（hugepage）是个什么？", "create_date": "2018/03/24 ·", "url": "http://blog.jobbole.com/113782/", "front_image": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "like": 1, "comment": 0, "collect": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://kerneltalks.com/services/what-is-huge-pages-in-linux/\">Shrikant Lavhate</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9450-1.html\">Linux中国/DarkSun</a>   </div><blockquote><p>学习 Linux 中的大内存页hugepage。理解什么是“大内存页”，如何进行配置，如何查看当前状态以及如何禁用它。</p></blockquote>\n<p>本文中我们会详细介绍大内存页huge page，让你能够回答：Linux 中的“大内存页”是什么？在 RHEL6、RHEL7、Ubuntu 等 Linux 中，如何启用/禁用“大内存页”？如何查看“大内存页”的当前值？</p>\n<p>首先让我们从“大内存页”的基础知识开始讲起。</p>\n<h3 id=\"toc_1\">Linux 中的“大内存页”是个什么玩意？</h3>\n<p>“大内存页”有助于 Linux 系统进行虚拟内存管理。顾名思义，除了标准的 4KB 大小的页面外，它们还能帮助管理内存中的巨大的页面。使用“大内存页”，你最大可以定义 1GB 的页面大小。</p>\n<p>在系统启动期间，你能用“大内存页”为应用程序预留一部分内存。这部分内存，即被“大内存页”占用的这些存储器永远不会被交换出内存。它会一直保留其中，除非你修改了配置。这会极大地提高像 Oracle 数据库这样的需要海量内存的应用程序的性能。</p>\n<h3 id=\"toc_2\">为什么使用“大内存页”？</h3>\n<p>在虚拟内存管理中，内核维护一个将虚拟内存地址映射到物理地址的表，对于每个页面操作，内核都需要加载相关的映射。如果你的内存页很小，那么你需要加载的页就会很多，导致内核会加载更多的映射表。而这会降低性能。</p>\n<p>使用“大内存页”，意味着所需要的页变少了。从而大大减少由内核加载的映射表的数量。这提高了内核级别的性能最终有利于应用程序的性能。</p>\n<p>简而言之，通过启用“大内存页”，系统具只需要处理较少的页面映射表，从而减少访问/维护它们的开销！</p>\n<h3 id=\"toc_3\">如何配置“大内存页”？</h3>\n<p>运行下面命令来查看当前“大内存页”的详细内容。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac179aec70cc622953350\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # grep Huge /proc/meminfo\r\nAnonHugePages:         0 kB\r\nHugePages_Total:       0\r\nHugePages_Free:        0\r\nHugePages_Rsvd:        0\r\nHugePages_Surp:        0\r\nHugepagesize:       2048 kB\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70cc622953350-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70cc622953350-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70cc622953350-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70cc622953350-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70cc622953350-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70cc622953350-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70cc622953350-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70cc622953350-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac179aec70cc622953350-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># grep Huge /proc/meminfo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70cc622953350-2\"><span class=\"crayon-v\">AnonHugePages</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kB</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70cc622953350-3\"><span class=\"crayon-v\">HugePages_Total</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70cc622953350-4\"><span class=\"crayon-v\">HugePages_Free</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70cc622953350-5\"><span class=\"crayon-v\">HugePages_Rsvd</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70cc622953350-6\"><span class=\"crayon-v\">HugePages_Surp</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70cc622953350-7\"><span class=\"crayon-v\">Hugepagesize</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">2048</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">kB</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70cc622953350-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>从上面输出可以看到，每个页的大小为 2MB（<code>Hugepagesize</code>），并且系统中目前有 <code>0</code> 个“大内存页”（<code>HugePages_Total</code>）。这里“大内存页”的大小可以从 <code>2MB</code> 增加到 <code>1GB</code>。</p>\n<p>运行下面的脚本可以知道系统当前需要多少个巨大页。该脚本取之于 Oracle。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac179aec70d5039714229\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/bash\r\n#\r\n# hugepages_settings.sh\r\n#\r\n# Linux bash script to compute values for the\r\n# recommended HugePages/HugeTLB configuration\r\n#\r\n# Note: This script does calculation for all shared memory\r\n# segments available when the script is run, no matter it\r\n# is an Oracle RDBMS shared memory segment or not.\r\n# Check for the kernel version\r\nKERN=`uname -r | awk -F. '{ printf(\"%d.%d\\n\",$1,$2); }'`\r\n# Find out the HugePage size\r\nHPG_SZ=`grep Hugepagesize /proc/meminfo | awk {'print $2'}`\r\n# Start from 1 pages to be on the safe side and guarantee 1 free HugePage\r\nNUM_PG=1\r\n# Cumulative number of pages required to handle the running shared memory segments\r\nfor SEG_BYTES in `ipcs -m | awk {'print $5'} | grep \"[0-9][0-9]*\"`\r\ndo\r\n   MIN_PG=`echo \"$SEG_BYTES/($HPG_SZ*1024)\" | bc -q`\r\n   if [ $MIN_PG -gt 0 ]; then\r\n      NUM_PG=`echo \"$NUM_PG+$MIN_PG+1\" | bc -q`\r\n   fi\r\ndone\r\n# Finish with results\r\ncase $KERN in\r\n   '2.4') HUGETLB_POOL=`echo \"$NUM_PG*$HPG_SZ/1024\" | bc -q`;\r\n          echo \"Recommended setting: vm.hugetlb_pool = $HUGETLB_POOL\" ;;\r\n   '2.6' | '3.8' | '3.10' | '4.1' ) echo \"Recommended setting: vm.nr_hugepages = $NUM_PG\" ;;\r\n    *) echo \"Unrecognized kernel version $KERN. Exiting.\" ;;\r\nesac\r\n# End\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70d5039714229-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70d5039714229-33\">33</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-1\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-2\"><span class=\"crayon-p\">#</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-3\"><span class=\"crayon-p\"># hugepages_settings.sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-4\"><span class=\"crayon-p\">#</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-5\"><span class=\"crayon-p\"># Linux bash script to compute values for the</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-6\"><span class=\"crayon-p\"># recommended HugePages/HugeTLB configuration</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-7\"><span class=\"crayon-p\">#</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-8\"><span class=\"crayon-p\"># Note: This script does calculation for all shared memory</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-9\"><span class=\"crayon-p\"># segments available when the script is run, no matter it</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-10\"><span class=\"crayon-p\"># is an Oracle RDBMS shared memory segment or not.</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-11\"><span class=\"crayon-p\"># Check for the kernel version</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-12\"><span class=\"crayon-v\">KERN</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">uname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">F</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{ printf(\"%d.%d\\n\",$1,$2); }'</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-13\"><span class=\"crayon-p\"># Find out the HugePage size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-14\"><span class=\"crayon-v\">HPG_SZ</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-e\">grep </span><span class=\"crayon-v\">Hugepagesize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">meminfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'print $2'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-15\"><span class=\"crayon-p\"># Start from 1 pages to be on the safe side and guarantee 1 free HugePage</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-16\"><span class=\"crayon-v\">NUM_PG</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-17\"><span class=\"crayon-p\"># Cumulative number of pages required to handle the running shared memory segments</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-18\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SEG_BYTES </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ipcs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'print $5'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"[0-9][0-9]*\"</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-19\"><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-20\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">MIN_PG</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$SEG_BYTES/($HPG_SZ*1024)\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-21\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">MIN_PG</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">gt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">NUM_PG</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$NUM_PG+$MIN_PG+1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-23\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-24\"><span class=\"crayon-v\">done</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-25\"><span class=\"crayon-p\"># Finish with results</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-26\"><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">KERN </span><span class=\"crayon-st\">in</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-27\"><span class=\"crayon-h\">   </span><span class=\"crayon-s\">'2.4'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HUGETLB_POOL</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$NUM_PG*$HPG_SZ/1024\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-28\"><span class=\"crayon-h\">          </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Recommended setting: vm.hugetlb_pool = $HUGETLB_POOL\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-29\"><span class=\"crayon-h\">   </span><span class=\"crayon-s\">'2.6'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3.8'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3.10'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'4.1'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Recommended setting: vm.nr_hugepages = $NUM_PG\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Unrecognized kernel version $KERN. Exiting.\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-31\"><span class=\"crayon-v\">esac</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70d5039714229-32\"><span class=\"crayon-p\"># End</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70d5039714229-33\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0067 seconds] -->\r\n<p>将它以 <code>hugepages_settings.sh</code> 为名保存到 <code>/tmp</code> 中，然后运行之：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac179aec70da237571835\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # sh /tmp/hugepages_settings.sh\r\nRecommended setting: vm.nr_hugepages = 124\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70da237571835-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70da237571835-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70da237571835-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac179aec70da237571835-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># sh /tmp/hugepages_settings.sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70da237571835-2\"><span class=\"crayon-e\">Recommended </span><span class=\"crayon-v\">setting</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nr_hugepages</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">124</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70da237571835-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你的输出类似如上结果，只是数字会有一些出入。</p>\n<p>这意味着，你系统需要 124 个每个 2MB 的“大内存页”！若你设置页面大小为 4MB，则结果就变成了 62。你明白了吧？</p>\n<h3 id=\"toc_4\">配置内核中的“大内存页”</h3>\n<p>本文最后一部分内容是配置上面提到的 <a href=\"https://kerneltalks.com/linux/how-to-tune-kernel-parameters-in-linux/\">内核参数 </a> ，然后重新加载。将下面内容添加到 <code>/etc/sysctl.conf</code> 中，然后输入 <code>sysctl -p</code> 命令重新加载配置。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac179aec70de708948673\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvm.nr_hugepages=126\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70de708948673-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70de708948673-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac179aec70de708948673-1\"><span class=\"crayon-v\">vm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nr_hugepages</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">126</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70de708948673-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>注意我们这里多加了两个额外的页，因为我们希望在实际需要的页面数量之外多一些额外的空闲页。</p>\n<p>现在，内核已经配置好了，但是要让应用能够使用这些“大内存页”还需要提高内存的使用阀值。新的内存阀值应该为 126 个页 x 每个页 2 MB = 252 MB，也就是 258048 KB。</p>\n<p>你需要编辑 <code>/etc/security/limits.conf</code> 中的如下配置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac179aec70e1705665494\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsoft memlock 258048\r\nhard memlock 258048\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70e1705665494-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac179aec70e1705665494-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac179aec70e1705665494-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac179aec70e1705665494-1\"><span class=\"crayon-e\">soft </span><span class=\"crayon-i\">memlock</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">258048</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac179aec70e1705665494-2\"><span class=\"crayon-e\">hard </span><span class=\"crayon-i\">memlock</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">258048</span></div><div class=\"crayon-line\" id=\"crayon-5ac179aec70e1705665494-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>某些情况下，这些设置是在指定应用的文件中配置的，比如 Oracle DB 就是在 <code>/etc/security/limits.d/99-grid-oracle-limits.conf</code> 中配置的。</p>\n<p>这就完成了！你可能还需要重启应用来让应用来使用这些新的巨大页。</p>\n<p>（LCTT 译注：此外原文有误，“透明大内存页”和“大内存页”不同，而且，在 Redhat 系统中，“大内存页” 不是默认启用的，而“透明大内存页”是启用的。因此这个段落删除了。）</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113782\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113782votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113782\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "ab0322e9007276c76fe370fbf4a95a33"},{"title": "IT 职场新人碰到的几个常见误区", "create_date": "2018/03/29 ·", "url": "http://blog.jobbole.com/112038/", "front_image": ["http://wx2.sinaimg.cn/large/7cc829d3gy1fptsk9tvx8j20go0b441z.jpg"], "like": 2, "comment": 0, "collect": 0, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/sankt/p/8658028.html\">沐榕休</a>   </div><p>自己工作 10+ 年了，大概 5 年前从技术转管理后，多少还是发现一些职场新人职业发展的问题。</p>\n<p>表现惊艳的新人肯定有，这种人往往在学校里面或者进入职场后就养成了一些非常良好的做事方式和工作习惯，工作效率高，产出多，甚至很短时间内就可以带新人，年度最佳新人当之无愧。</p>\n<p>然而表现不到位的似乎更多一些，这些员工工作时间短（比如说应届毕业生或者不到两年）尤其性格内向的往往容易掉入错误泥潭，无法自拔，而这些错误的行为会对未来的发展造成非常负面的影响，从而导致职场发展往失败的道路上越走越远。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fptsk9tvx8j20go0b441z.jpg\"></p>\n<p>我分别从以下角度来阐述一下，</p>\n<h3>1. 不愿意和同事沟通，不愿意向同事多学习</h3>\n<p>这种员工大多比较内向或者性情有点高冷，须不知三人行，必有我师。多向同事学习，互通有无，对自己以后的发展有百利而无一害。有导师制或者老员工带，情况或许会有所改善，但如果内因没有改变，最终效果依旧不容乐观。</p>\n<p>技术开发工作中遇到一些技术难题非常正常，当然独立思考固然可贵，但是公司项目往往有一定的时间限制，优先解决问题永远放在第一位，而不是一个人在那里苦苦挣扎和搜索解决方案。如果时间压力不大，多思考一下也未尝不可。考虑到交付压力，这个时候就需要积极和同事，技术经理沟通，寻找解决思路，通常情况下，积极的沟通好过自己的单打独斗。也许同事或者老板的一句话，就应了那据古诗，山重水复疑无路，柳暗花明又一村。与此同时也和同事建立了更好的友谊，在老板心里也留下了做事有方法的好印象。</p>\n<h3>2.视野狭窄，只关注自己的一亩三分地，囿于角色</h3>\n<p>这种情况其实在职场中多见不仅是初级程序员，甚至工作五年以上的程序员也有类似的问题，不是自己的事情不闻不问，而且危害更大。</p>\n<p>公司项目往往大而全，如果仅仅专注自己的那个角落，那么永远都是只见树木，不见森林。</p>\n<p>我相信没有老板会介意下面的程序员多承担一些责任，多做一些事情，最后给项目组多一些产出。</p>\n<p>既然老板不介意，那么就应该大胆的跳出自己的职责范围，多看看公司的其他项目，丰富自己的行业知识。</p>\n<p>职责外的事情，帮的上的不要躲避,，努力承担更多的东西。帮助别人就是提高自己，教学相长就是这个意思。况且你这次帮了别人，下次你的项目紧或者遇到技术难题了，受助之人肯定投桃报李，这样就形成了良性互助氛围，整个项目组的产出也同步提升了。</p>\n<p>一般来说，公司要提升一个人，最好的策略就是先让候选人做一些将来职位才需要做的事情。做的好，理所当然就要提拔。做的不好，则可以提前发现该员工的问题，暂缓提拔，需要多考察一段时间。这样的试错成本毫无疑问是最低的。</p>\n<h3>3.格局太小，对项目以外的技术视而不见，知识面陈旧，匮乏，技能极其单一</h3>\n<p>这里其实谈到了整个IT行业的问题，技术发展太快了。主要还是一个持续提升竞争力的一个话题。</p>\n<p>今天还是桌面开发，明天web开发就成为主流。</p>\n<p>好不容易掌握了关系型数据库，No-SQL成为主流。</p>\n<p>费了九牛二虎之力，熟练掌握Java, C#等静态语言，发现动态语言GO, Python成为云计算，机器学习的标配。</p>\n<p>移动开发昨天还是Object-C, Java, 今天就变成Swift, Kotlin。</p>\n<p> </p>\n<p>当然这里不是说让大家紧跟潮流，扼住时尚。那样做除了疲于奔命，累死在工作台，没有其他的结果。</p>\n<p>其实只要选择一个方向，纵深学习和积累，必有所成。</p>\n<p>比如说，你熟悉 Java, 那么学习 Kotlin 绝对驾轻就熟。</p>\n<p>你有扎实的关系型数据库基础，那么掌握 MangoDB 肯定是件轻而易举的事情。</p>\n<p>编成思想和解决问题的思路都是相通的，平时的学习和工作中要善于思考，举一反三。并且做到与时俱进，及时更新自己的知识库和技能属性，保持良好的市场竞争力。</p>\n<p>做完事情后多思考，怎样做得更好，站在更好的要求上看问题.</p>\n<p>我举两个实际案例，</p>\n<blockquote><p>程序员A在某国企里面，持续开发 Windows Form, 拖拉控件为主，对SQL Server数据库增删改查，时间长达五年之久，突然有一天打算离职，看看新的机会，以为有五年工作经验，可以很轻松找一个更好的工作。但是实际上求职之路异常艰辛，名义上的五年工作经验，其实就是极其单一的技能重复使用了五年。而且大环境也变了，主流已经是web开发，移动开发了。因为没有及时更新自己的知识库和技能储备，那么真要跳槽的时候可能已经跳不动了。</p>\n<p>程序员B在某外企，氛围比较安逸轻松，项目节奏慢，看似也作了不少项目，但做的项目几乎比较类似，难度一般，涉及面挺广，但技术点都是蜻蜓点水，浅尝辄止。这样过了三年，其实积累也是比较松散，知识的深度没有，核心技能并没有养成。</p></blockquote>\n<h3>4.对未来没有想法，不考虑三五年自己要做什么</h3>\n<p>作者本人就犯过类似的错误，幡然醒悟的时候，三年时间已经过去了。</p>\n<p>程序员的职业生涯里面最初的三年其实是一个非常重要的打磨和规划时期，如果在迷茫中度过，那么事后想起肯定会扼腕叹息，奈何流水已经东去，再无复返之理。</p>\n<p>有目标，而没有具体的计划，那么就是一个愿景而已。</p>\n<p>建议不管是初级还是高级程序员，都应该积极向前辈或者直属老板沟通，看看他们有没有值得借鉴的规划和建议。</p>\n<p>职场大忌就是被动等待命运的安排，作者本人也是在职业生涯初期等待老板来帮我规划未来，到现在为止，十年过去了，也没有等到。。。</p>\n<p>所以老板不会主动帮助你规划未来，最重要的事情还是自己对自身的要求和期望。</p>\n<p> </p>\n<h3>5.没有意识到是给自己打工还是公司打工</h3>\n<p>这也是一个非常好的话题，很多人都没有想明白，甚至包括一些工作十年之久的程序员。</p>\n<p>想明白这一点，工作积极性明显就会好太多。自我驱动, 让工作更加有趣和有意义。</p>\n<p>国内知名的互联网公司大老板说过一句话，非常值得深思。</p>\n<p>“我每年付你20万，五年也就是100万。如果你在这里混日子，那么最后吃亏的肯定是你。你的五年青春就只值100万吗？”</p>\n<p>所以职场新人的主人翁意识一定要加强，你要持续提升自己的能力，持续强化自己创造价值的能力。</p>\n<p>举个例子，比如说现在公司支付你20万每年，那么你应该有目标能给公司带来远超过20万的收益，多多益善。</p>\n<p>你有这个能力，公司肯定也会对你相应回报。如果公司不给你升职加薪，那么一走了之，潇洒痛快。优质的人才从来都是抢着要。</p>\n<h3>6.不愿意走出舒适区域，不敢尝试新的东西</h3>\n<p>这点倒是因人而异，不可强求。这个话题其实有点广义。</p>\n<p>如果你在某个方向做的非常好，而且回报也不错，那么不愿意涉足其他领域也无可厚非。</p>\n<p>这个世界唯一不变的东西就是世界一直在改变。今天还有的岗位，明天也许就要消失。世界要抛弃你，都不会打一声招呼。</p>\n<blockquote><p>举个例子，你在公司是SQL Server或者Oracle专家，但是公司计划转非关系型数据库，如果你害怕改变甚至拒绝改变，那么意味着你可能要错过另外一个全新的数据存储平台。进而错过很多机会，而那些勇于接受变化，顺应趋势的人肯定会获得更好的时代回报。</p></blockquote>\n<p>又比如说，你现在用的技术在日常项目中都刚好够用，那么从改善用户体验和使用更加主流的技术角度看，是不是应该要尝试一些新的东西，同时也刷新了自己的技术栈，一举两得，何乐而不为呢？</p>\n<blockquote><p>还有一个例子是一位资深程序员习惯了长期的慢节奏的工作氛围，因为公司改组被裁员，不过自身条件不错，很快就加入国内一家一线互联网公司，但是完全适应不了互联网快节奏，工作一段时间就以公司管理”混乱”，战略规划”经常”改变为借口离职了，接下来很长一段时间找不到一个合适自己的工作，加上中年已到，如果自身不积极调整，接下来的工作和生活肯定困难重重。</p></blockquote>\n<h3>总结</h3>\n<p>最后再简单小结一下，职场新人需要做的就是从小事做起，学会吃亏，以结果为目标导向，日常工作中积极和同事，老板沟通。</p>\n<p>工作中要善于总结方法，经常更新问题的思考模式，对职业负责，对目标负责，对自己负责，脚踏实地，主动找事情做，而不是被动等事情来找你。</p>\n<p>相信职场新人如果能成功避开上面说的几个误区，那么在职业发展道路上就可以少走一些弯路，少犯一些错误，从而更快地实现自己的小目标。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112038\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112038votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112038\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "4982221dc7233a7fb52e97b15b7f65e8"},{"title": "刚开始学编程？这几款小工具能让你事半功倍", "create_date": "2018/03/26 ·", "url": "http://blog.jobbole.com/113785/", "front_image": ["https://pic.36krcnd.com/201803/10141844/8fkz2ekh01zhphjt.jpeg!1200"], "like": 1, "comment": 1, "collect": 5, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://medium.freecodecamp.org/tools-i-wish-i-had-known-about-when-i-started-coding-57849efd9248\">Mario Hoyos</a>   译文出处：<a target=\"_blank\" href=\"http://36kr.com/p/5121154.html\">36氪</a>   </div><p><img src=\"https://pic.36krcnd.com/201803/10141844/8fkz2ekh01zhphjt.jpeg!1200\" alt=\"åå¼å§å­¦ç¼ç¨ï¼è¿å æ¬¾å°å·¥å·è½è®©ä½ äºååå\"></p>\n<p>科技行业里，可供人们使用的工具成百上千，你要怎么知道用哪一种上手最合适呢？</p>\n<p>拿最近刚进入编程这行的人来说吧，大量的工具信息堆砌过来其实毫无益处，反而会无从下手。我发现在自己的开发过程中，很多安装的扩展工具不仅没有真正起到助益作用，反而常常妨碍了正常的开发工作。</p>\n<p>我不是专家，不过随着时间的推移，我还是编制了一份工具清单，这些工具已经证明对我非常有用。如果你刚刚开始学习怎么编程的话，这个清单能给你提供一些指导。如果你是个经验丰富的开发人员，也希望你能从中学到一些新的东西。</p>\n<p>我将把这篇文章分为Chrome扩展程序和VS代码扩展扩展程序两部分。我知道还有其他的浏览器和文本编辑器，但是我想你当然只能在你能找到的工具里选择，所以还是别因为个人喜好而引起一场宗教般的争论。</p>\n<p>请随便选。</p>\n<h3>Chrome扩展程序</h3>\n<p><span class=\"load-html-img loaded\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/8b4aab0d40f4316375f7cd578ff0286e.jpeg\" alt=\"刚开始学编程？这几款小工具能让你事半功倍\"></span></p>\n<p>现在设我是一位web开发人员，以Chrome为阵地。下面是一些能让我少花点时间的工具：</p>\n<ul class=\" list-paddingleft-2\">\n<li><a href=\"https://chrome.google.com/webstore/detail/whatfont/jabopobgcpjmedljpbcaablpmlmfcogm?hl=en\">WhatFont</a> —— 名字就说明了一切。这是找出你最喜欢网站使用的字体的简单方法，这样你就可以为己所用了。</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/pesticide-for-chrome/bblbgcheenepgnnajgfpiicnbbdmmooh?hl=en\">Pesticide</a>—— 修改CSS的绝佳程序。当我试着学习匣子模型的时候，它简直就是救命稻草般的存在。</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/colorzilla/bhlhnicpbhignbdhedgjhgdocnmhomnp?hl=en\">Colorzilla</a> ——用于复制确切颜色的一个网站，用它可以将颜色直接复制到剪贴板上，这样你就没必要花太多时间获得正确的RGBA组合了。</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/css-peeper/mbnbehikldjhnfehhnaidhjhoofhpehk?hl=en\">CSS Peeper</a>——查看网站使用的颜色时非常方便。在你一开始山寨你认为酷的网站的时候很管用。这个程序能让你查看它们的幕后的色彩方案。</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/wappalyzer/gppongmhjkpfnbhagpmjfkannfbllamg?hl=en\">Wappalyzer</a> ——想要获悉你在网站上看到的是什么技术，这个程序很有用。想知道某网站使用什么样的框架或者它承载了什么服务？这个照样管用。</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en\">React Dev Tools</a>——一款用于调试应用程序的工具。有一点要提一下，它只有在你编写React程序时才有用。</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?hl=en\">Redux Dev Tools</a>——一款用于调试应用程序的工具。有一点要提一下，它只有在你编写Redux程序时才有用。</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa?hl=en\">JSON Formatter</a> ——让JSON在浏览器中看起来更一目了然的不二之选。也许麻烦的JSON让你苦不堪言，不过只要用了这个软件，找到你要找的东西，所花费的时间会大幅缩短。</li>\n<li><a href=\"https://chrome.google.com/webstore/detail/vimeo-repeat-speed/noonakfaafcdaagngpjehilgegefdima?hl=en\">Vimeo Repeat and Speed</a> ——加速Vimeo视频的绝佳工具。如果你像大多数的web开发人员一样观看视频教程，你就会知道用1.25倍的常规回放速度观看它们是多么的方便。本程序同时也有适用于YouTube的版本。</li>\n</ul>\n<h3>VS Code扩展程序</h3>\n<p><span class=\"load-html-img loaded\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/6f53b4a3d95c1c5b648380d21c6e90fa.jpeg\" alt=\"刚开始学编程？这几款小工具能让你事半功倍\"></span></p>\n<p>Visual Studio Code是我写代码时的不二之选。</p>\n<p>每个人都有他自己喜欢的文本编辑器，我也不例外。不过，我还是想把这些扩展程序介绍给你，而它们对你所使用的大多数编辑器都适用。看看我最喜欢的扩展程序有哪些：</p>\n<ul class=\" list-paddingleft-2\">\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=formulahendry.auto-rename-tag\">Auto Rename Tag </a>——自动重命名成对的HTML标记。假如你创建了一个&lt;p&gt;标记。现在你想更改它。有了这个软件，你只需要更改一个就行，另一个会自动修改。从理论上来说，使用这个软件可以把你的工作效率提升一倍。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=ecmel.vscode-html-css\">HTML CSS Support</a> ——HTML文档的CSS支持工具。该工具在获得一些简洁的语法高亮显示和代码建议方面非常有用。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=abusaidm.html-snippets\">HTML Snippets</a> ——这一工具在代码分段方面非常有用，可以为你节省大量的时间。它能跟Emmet配对，这样一来你甚至都不用再真正键入HTML了。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=dzannotti.vscode-babel-coloring\">Babel ES6/ES7</a> ——JavaScript Babel的辅助工具。如果你用的是Babel，这个工具可以让你更容易区分代码。如果你喜欢JavaScript，那务必也不要错过这款软件。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer\">Bracket Pair Colorizer </a>——色彩可视化工具。如果你没有准确地括号，那这个工具对于发现因此导致的许多常见漏洞十分方便。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint\">ESLint </a>——你在编写代码的时候，利用这个软件可以轻易获取有关漏洞的提示，而且在编码过程中，它还可以帮助你养成良好的编码习惯。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=spywhere.guides\">Guides</a> ——这一工具可以被用来添加额外的指导行代码。这是另一个视觉提示，以确保你正确地括号了。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=whtouche.vscode-js-console-utils\">JavaScript Console Utils </a>——使控制台日志记录变得更为简单可行。如果你像大多数开发人员一样，你会发现自己需要在调试流中登录到控制台（我知道我们应该使用调试器）。这个实用的程序使得创建有用的console.log()语句变得易如反掌。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=streetsidesoftware.code-spell-checker\">Code Spell Checker</a> ——这一工具正如其名，是拼写检查程序。漏洞的的另一个常见来源是变量或函数名。这一拼写检查工具可以查找不常见的单词，而且还可以把我们用JavaScript编写的东西进行有效的审核。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens\">Git Lens</a> ——可以让我们对某文件何时、以及由何人进行更改变得一目了然。当代码被破坏时，我们就能找到该负责任的人，而不是让你当替罪羊了。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense\">Path Intellisense</a> ——文件路径自动完成程序。这样一来从其他文件中导入重要的东西就非常方便了。这一工具使文件导航变得轻而易举。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode\">Prettier </a>——自动代码格式化程序。忘掉那些你不得不手动缩进代码的日子吧，有了这个工具，事情就变得简单多啦。这个程序会比你自己做得更快更好。对这个程序我是鼎力推荐的。</li>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=robertohuertasm.vscode-icons\">VSCode-Icons</a> ——将图标添加到文件谱中。如果文件结构非常不科学，你的眼睛想罢工的话，这个程序可能会有所帮助。它对于你正在制作的任何文件都能提供有用的图标辅助，能使你更为轻易地区分看到的内容。</li>\n</ul>\n<h3>总结</h3>\n<p>你肯定也有自己中意的工具，这些工具对你的开发工作来说是必不可少的。也希望我上面提到的一些工具能够提高你的工作效率。</p>\n<p>但是千万不要落入贪多不烂的陷阱，因为它可能耗费很多时间。</p>\n<p>希望你能在评论区留下你最喜欢的工具，这样我们就可以共同进步了。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113785\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113785votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113785\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "86a8795768a1192f6a4d22bbb49ab0d7"},{"title": "深入学习 Redis（1）：Redis 内存模型", "create_date": "2018/03/27 ·", "url": "http://blog.jobbole.com/113789/", "front_image": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "like": 2, "comment": 0, "collect": 1, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/kismetv/p/8654978.html\">编程迷思</a>   </div><h2>前言</h2>\n<p>Redis是目前最火爆的内存数据库之一，通过在内存中读写数据，大大提高了读写速度，可以说Redis是实现网站高并发不可或缺的一部分。</p>\n<p>我们使用Redis时，会接触Redis的5种对象类型（字符串、哈希、列表、集合、有序集合），丰富的类型是Redis相对于Memcached等的一大优势。在了解Redis的5种对象类型的用法和特点的基础上，进一步了解Redis的内存模型，对Redis的使用有很大帮助，例如：</p>\n<p>1、估算Redis内存使用量。目前为止，内存的使用成本仍然相对较高，使用内存不能无所顾忌；根据需求合理的评估Redis的内存使用量，选择合适的机器配置，可以在满足需求的情况下节约成本。</p>\n<p>2、优化内存占用。了解Redis内存模型可以选择更合适的数据类型和编码，更好的利用Redis内存。</p>\n<p>3、分析解决问题。当Redis出现阻塞、内存占用等问题时，尽快发现导致问题的原因，便于分析解决问题。</p>\n<p>这篇文章主要介绍Redis的内存模型（以3.0为例），包括Redis占用内存的情况及如何查询、不同的对象类型在内存中的编码方式、内存分配器(jemalloc)、简单动态字符串(SDS)、RedisObject等；然后在此基础上介绍几个Redis内存模型的应用。</p>\n<p>在后面的文章中，会陆续介绍关于Redis高可用的内容，包括主从复制、哨兵、集群等等，欢迎关注。</p>\n<p> </p>\n<h2>目录</h2>\n<p><a href=\"#t1\">一、Redis内存统计</a></p>\n<p><a href=\"#t2\">二、Redis内存划分</a></p>\n<p><a href=\"#t21\">1、数据（或者称为对象）</a></p>\n<p><a href=\"#t22\">2、进程本身运行需要的内存</a></p>\n<p><a href=\"#t23\">3、缓冲内存</a></p>\n<p><a href=\"#t24\">4、内存碎片</a></p>\n<p><a href=\"#t3\">三、Redis数据存储的细节</a></p>\n<p><a href=\"#t31\">1、概述</a></p>\n<p><a href=\"#t32\">2、jemalloc</a></p>\n<p><a href=\"#t33\">3、redisObject</a></p>\n<p><a href=\"#t34\">4、SDS</a></p>\n<p><a href=\"#t4\">四、Redis的对象类型与内部编码</a></p>\n<p><a href=\"#t41\">1、字符串</a></p>\n<p><a href=\"#t42\">2、列表</a></p>\n<p><a href=\"#t43\">3、哈希</a></p>\n<p><a href=\"#t44\">4、集合</a></p>\n<p><a href=\"#t45\">5、有序集合</a></p>\n<p><a href=\"#t5\">五、应用举例</a></p>\n<p><a href=\"#t51\">1、估算Redis内存使用量</a></p>\n<p><a href=\"#t52\">2、优化内存占用</a></p>\n<p><a href=\"#t53\">3、关注内存碎片率</a></p>\n<p><a href=\"#t6\">六、参考文献</a></p>\n<h1><a name=\"t1\"></a>一、Redis内存统计</h1>\n<p>工欲善其事必先利其器，在说明Redis内存之前首先说明如何统计Redis使用内存的情况。</p>\n<p>在客户端通过redis-cli连接服务器后（后面如无特殊说明，客户端一律使用redis-cli），通过info命令可以查看内存使用情况：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac193903fc96218759658\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninfo memory</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac193903fc96218759658-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac193903fc96218759658-1\"><span class=\"crayon-e\">info </span><span class=\"crayon-v\">memory</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n\n</div>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/8c3d1b1af4dea80d14b73aad3232d6c2.png\" alt=\"\"></p>\n<p>其中，info命令可以显示redis服务器的许多信息，包括服务器基本信息、CPU、内存、持久化、客户端连接信息等等；memory是参数，表示只显示内存相关的信息。</p>\n<p>返回结果中比较重要的几个说明如下：</p>\n<p>（1）<strong>used_memory</strong><strong>：</strong>Redis分配器分配的内存总量（单位是字节），包括使用的虚拟内存（即swap）；Redis分配器后面会介绍。used_memory_human只是显示更友好。</p>\n<p>（2）<strong>used_memory_rss</strong><strong>：</strong>Redis进程占据操作系统的内存（单位是字节），与top及ps命令看到的值是一致的；除了分配器分配的内存之外，used_memory_rss还包括进程运行本身需要的内存、内存碎片等，但是不包括虚拟内存。</p>\n<p>因此，used_memory和used_memory_rss，前者是从Redis角度得到的量，后者是从操作系统角度得到的量。二者之所以有所不同，一方面是因为内存碎片和Redis进程运行需要占用内存，使得前者可能比后者小，另一方面虚拟内存的存在，使得前者可能比后者大。</p>\n<p>由于在实际应用中，Redis的数据量会比较大，此时进程运行占用的内存与Redis数据量和内存碎片相比，都会小得多；因此used_memory_rss和used_memory的比例，便成了衡量Redis内存碎片率的参数；这个参数就是mem_fragmentation_ratio。</p>\n<p>（3）<strong>mem_fragmentation_ratio</strong><strong>：</strong>内存碎片比率，该值是used_memory_rss / used_memory的比值。</p>\n<p>mem_fragmentation_ratio一般大于1，且该值越大，内存碎片比例越大。mem_fragmentation_ratio&lt;1，说明Redis使用了虚拟内存，由于虚拟内存的媒介是磁盘，比内存速度要慢很多，当这种情况出现时，应该及时排查，如果内存不足应该及时处理，如增加Redis节点、增加Redis服务器的内存、优化应用等。</p>\n<p>一般来说，mem_fragmentation_ratio在1.03左右是比较健康的状态（对于jemalloc来说）；上面截图中的mem_fragmentation_ratio值很大，是因为还没有向Redis中存入数据，Redis进程本身运行的内存使得used_memory_rss 比used_memory大得多。</p>\n<p>（4）<strong>mem_allocator</strong><strong>：</strong>Redis使用的内存分配器，在编译时指定；可以是 libc 、jemalloc或者tcmalloc，默认是jemalloc；截图中使用的便是默认的jemalloc。</p>\n<h1><a name=\"t2\"></a>二、Redis内存划分</h1>\n<p>Redis作为内存数据库，在内存中存储的内容主要是数据（键值对）；通过前面的叙述可以知道，除了数据以外，Redis的其他部分也会占用内存。</p>\n<p>Redis的内存占用主要可以划分为以下几个部分：</p>\n<h2><a name=\"t21\"></a>1、数据</h2>\n<p>作为数据库，数据是最主要的部分；这部分占用的内存会统计在used_memory中。</p>\n<p>Redis使用键值对存储数据，其中的值（对象）包括5种类型，即字符串、哈希、列表、集合、有序集合。这5种类型是Redis对外提供的，实际上，在Redis内部，每种类型可能有2种或更多的内部编码实现；此外，Redis在存储对象时，并不是直接将数据扔进内存，而是会对对象进行各种包装：如redisObject、SDS等；这篇文章后面将重点介绍Redis中数据存储的细节。</p>\n<h2><a name=\"t22\"></a>2、进程本身运行需要的内存</h2>\n<p>Redis主进程本身运行肯定需要占用内存，如代码、常量池等等；这部分内存大约几兆，在大多数生产环境中与Redis数据占用的内存相比可以忽略。这部分内存不是由jemalloc分配，因此不会统计在used_memory中。</p>\n<p>补充说明：除了主进程外，Redis创建的子进程运行也会占用内存，如Redis执行AOF、RDB重写时创建的子进程。当然，这部分内存不属于Redis进程，也不会统计在used_memory和used_memory_rss中。</p>\n<h2><a name=\"t23\"></a>3、缓冲内存</h2>\n<p>缓冲内存包括客户端缓冲区、复制积压缓冲区、AOF缓冲区等；其中，客户端缓冲存储客户端连接的输入输出缓冲；复制积压缓冲用于部分复制功能；AOF缓冲区用于在进行AOF重写时，保存最近的写入命令。在了解相应功能之前，不需要知道这些缓冲的细节；这部分内存由jemalloc分配，因此会统计在used_memory中。</p>\n<h2><a name=\"t24\"></a>4、内存碎片</h2>\n<p>内存碎片是Redis在分配、回收物理内存过程中产生的。例如，如果对数据的更改频繁，而且数据之间的大小相差很大，可能导致redis释放的空间在物理内存中并没有释放，但redis又无法有效利用，这就形成了内存碎片。内存碎片不会统计在used_memory中。</p>\n<p>内存碎片的产生与对数据进行的操作、数据的特点等都有关；此外，与使用的内存分配器也有关系：如果内存分配器设计合理，可以尽可能的减少内存碎片的产生。后面将要说到的jemalloc便在控制内存碎片方面做的很好。</p>\n<p>如果Redis服务器中的内存碎片已经很大，可以通过安全重启的方式减小内存碎片：因为重启之后，Redis重新从备份文件中读取数据，在内存中进行重排，为每个数据重新选择合适的内存单元，减小内存碎片。</p>\n<h1><a name=\"t3\"></a>三、Redis数据存储的细节</h1>\n<h2><a name=\"t31\"></a>1、概述</h2>\n<p>关于Redis数据存储的细节，涉及到内存分配器（如jemalloc）、简单动态字符串（SDS）、5种对象类型及内部编码、redisObject。在讲述具体内容之前，先说明一下这几个概念之间的关系。</p>\n<p>下图是执行set hello world时，所涉及到的数据模型。</p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/e68530a523ccf27f161597f21994f842.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图片来源：https://searchdatabase.techtarget.com.cn/7-20218/</p>\n<p>（1）dictEntry：Redis是Key-Value数据库，因此对每个键值对都会有一个dictEntry，里面存储了指向Key和Value的指针；next指向下一个dictEntry，与本Key-Value无关。</p>\n<p>（2）Key：图中右上角可见，Key（”hello”）并不是直接以字符串存储，而是存储在SDS结构中。</p>\n<p>（3）redisObject：Value(“world”)既不是直接以字符串存储，也不是像Key一样直接存储在SDS中，而是存储在redisObject中。实际上，不论Value是5种类型的哪一种，都是通过redisObject来存储的；而redisObject中的type字段指明了Value对象的类型，ptr字段则指向对象所在的地址。不过可以看出，字符串对象虽然经过了redisObject的包装，但仍然需要通过SDS存储。</p>\n<p>实际上，redisObject除了type和ptr字段以外，还有其他字段图中没有给出，如用于指定对象内部编码的字段；后面会详细介绍。</p>\n<p>（4）jemalloc：无论是DictEntry对象，还是redisObject、SDS对象，都需要内存分配器（如jemalloc）分配内存进行存储。以DictEntry对象为例，有3个指针组成，在64位机器下占24个字节，jemalloc会为它分配32字节大小的内存单元。</p>\n<p>下面来分别介绍jemalloc、redisObject、SDS、对象类型及内部编码。</p>\n<h2><a name=\"t32\"></a>2、jemalloc</h2>\n<p>Redis在编译时便会指定内存分配器；内存分配器可以是 libc 、jemalloc或者tcmalloc，默认是jemalloc。</p>\n<p>jemalloc作为Redis的默认内存分配器，在减小内存碎片方面做的相对比较好。jemalloc在64位系统中，将内存空间划分为小、大、巨大三个范围；每个范围内又划分了许多小的内存块单位；当Redis存储数据时，会选择大小最合适的内存块进行存储。</p>\n<p>jemalloc划分的内存单元如下图所示：</p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/34ac5c647e31f0ab02036d78ee63f248.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图片来源：http://blog.csdn.net/zhengpeitao/article/details/76573053</p>\n<p>例如，如果需要存储大小为130字节的对象，jemalloc会将其放入160字节的内存单元中。</p>\n<h2><a name=\"t33\"></a>3、redisObject</h2>\n<p>前面说到，Redis对象有5种类型；无论是哪种类型，Redis都不会直接存储，而是通过redisObject对象进行存储。</p>\n<p>redisObject对象非常重要，Redis对象的类型、内部编码、内存回收、共享对象等功能，都需要redisObject支持，下面将通过redisObject的结构来说明它是如何起作用的。</p>\n<p>redisObject的定义如下（不同版本的Redis可能稍稍有所不同）：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac193903fca7513880773\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntypedef struct redisObject {\r\n　　unsigned type:4;\r\n　　unsigned encoding:4;\r\n　　unsigned lru:REDIS_LRU_BITS; /* lru time (relative to server.lruclock) */\r\n　　int refcount;\r\n　　void *ptr;\r\n} robj;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac193903fca7513880773-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fca7513880773-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fca7513880773-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fca7513880773-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fca7513880773-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fca7513880773-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fca7513880773-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac193903fca7513880773-1\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redisObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fca7513880773-2\">　　<span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fca7513880773-3\">　　<span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fca7513880773-4\">　　<span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lru</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">REDIS_LRU_BITS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* lru time (relative to server.lruclock) */</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fca7513880773-5\">　　<span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">refcount</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fca7513880773-6\">　　<span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">ptr</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fca7513880773-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">robj</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>redisObject的每个字段的含义和作用如下：</p>\n<h3>（1）type</h3>\n<p>type字段表示对象的类型，占4个比特；目前包括REDIS_STRING(字符串)、REDIS_LIST (列表)、REDIS_HASH(哈希)、REDIS_SET(集合)、REDIS_ZSET(有序集合)。</p>\n<p>当我们执行type命令时，便是通过读取RedisObject的type字段获得对象的类型；如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/43d3539f6d0124bd1581566616b64f97.png\" alt=\"\"></p>\n<h3>（2）encoding</h3>\n<p>encoding表示对象的内部编码，占4个比特。</p>\n<p>对于Redis支持的每种类型，都有至少两种内部编码，例如对于字符串，有int、embstr、raw三种编码。通过encoding属性，Redis可以根据不同的使用场景来为对象设置不同的编码，大大提高了Redis的灵活性和效率。以列表对象为例，有压缩列表和双端链表两种编码方式；如果列表中的元素较少，Redis倾向于使用压缩列表进行存储，因为压缩列表占用内存更少，而且比双端链表可以更快载入；当列表对象元素较多时，压缩列表就会转化为更适合存储大量元素的双端链表。</p>\n<p>通过object encoding命令，可以查看对象采用的编码方式，如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/f6339c50fe0f4a46f0059b2f35231e23.png\" alt=\"\"></p>\n<p>5种对象类型对应的编码方式以及使用条件，将在后面介绍。</p>\n<h3>（3）lru</h3>\n<p>lru记录的是对象最后一次被命令程序访问的时间，占据的比特数不同的版本有所不同（如4.0版本占24比特，2.6版本占22比特）。</p>\n<p>通过对比lru时间与当前时间，可以计算某个对象的空转时间；object idletime命令可以显示该空转时间（单位是秒）。object idletime命令的一个特殊之处在于它不改变对象的lru值。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/12d2cec6e14b158f69fda46c75601482.png\" alt=\"\"></p>\n<p>lru值除了通过object idletime命令打印之外，还与Redis的内存回收有关系：如果Redis打开了maxmemory选项，且内存回收算法选择的是volatile-lru或allkeys—lru，那么当Redis内存占用超过maxmemory指定的值时，Redis会优先选择空转时间最长的对象进行释放。</p>\n<h3>（4）refcount</h3>\n<p><strong>refcount</strong><strong>与共享对象</strong></p>\n<p>refcount记录的是该对象被引用的次数，类型为整型。refcount的作用，主要在于对象的引用计数和内存回收。当创建新对象时，refcount初始化为1；当有新程序使用该对象时，refcount加1；当对象不再被一个新程序使用时，refcount减1；当refcount变为0时，对象占用的内存会被释放。</p>\n<p>Redis中被多次使用的对象(refcount&gt;1)，称为共享对象。Redis为了节省内存，当有一些对象重复出现时，新的程序不会创建新的对象，而是仍然使用原来的对象。这个被重复使用的对象，就是共享对象。目前共享对象仅支持整数值的字符串对象。</p>\n<p><strong>共享对象的具体实现</strong></p>\n<p>Redis的共享对象目前只支持整数值的字符串对象。之所以如此，实际上是对内存和CPU（时间）的平衡：共享对象虽然会降低内存消耗，但是判断两个对象是否相等却需要消耗额外的时间。对于整数值，判断操作复杂度为O(1)；对于普通字符串，判断复杂度为O(n)；而对于哈希、列表、集合和有序集合，判断的复杂度为O(n^2)。</p>\n<p>虽然共享对象只能是整数值的字符串对象，但是5种类型都可能使用共享对象（如哈希、列表等的元素可以使用）。</p>\n<p>就目前的实现来说，Redis服务器在初始化时，会创建10000个字符串对象，值分别是0~9999的整数值；当Redis需要使用值为0~9999的字符串对象时，可以直接使用这些共享对象。10000这个数字可以通过调整参数REDIS_SHARED_INTEGERS（4.0中是OBJ_SHARED_INTEGERS）的值进行改变。</p>\n<p>共享对象的引用次数可以通过object refcount命令查看，如下图所示。命令执行的结果页佐证了只有0~9999之间的整数会作为共享对象。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/da89cea4d30533c989b73b07efd27317.png\" alt=\"\"></p>\n<h3>（5）ptr</h3>\n<p>ptr指针指向具体的数据，如前面的例子中，set hello world，ptr指向包含字符串world的SDS。</p>\n<h3>（6）总结</h3>\n<p>综上所述，redisObject的结构与对象类型、编码、内存回收、共享对象都有关系；一个redisObject对象的大小为16字节：</p>\n<p>4bit+4bit+24bit+4Byte+8Byte=16Byte。</p>\n<h2><a name=\"t34\"></a>4、SDS</h2>\n<p>Redis没有直接使用C字符串(即以空字符’\\0’结尾的字符数组)作为默认的字符串表示，而是使用了SDS。SDS是简单动态字符串(Simple Dynamic String)的缩写。</p>\n<h3>（1）SDS结构</h3>\n<p>sds的结构如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac193903fcb3989438853\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstruct sdshdr { \r\n    int len;\r\n    int free;\r\n    char buf[];\r\n};</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcb3989438853-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcb3989438853-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcb3989438853-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcb3989438853-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcb3989438853-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac193903fcb3989438853-1\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sdshdr</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcb3989438853-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcb3989438853-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">free</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcb3989438853-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcb3989438853-5\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>其中，buf表示字节数组，用来存储字符串；len表示buf已使用的长度，free表示buf未使用的长度。下面是两个例子。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/2116fb2f5ea2170e8e9df0032c1fad4d.png\" alt=\"\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/951c87cee3bcd2599fcdddac9167d232.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图片来源：《Redis设计与实现》</p>\n<p>通过SDS的结构可以看出，buf数组的长度=free+len+1（其中1表示字符串结尾的空字符）；所以，一个SDS结构占据的空间为：free所占长度+len所占长度+ buf数组的长度=4+4+free+len+1=free+len+9。</p>\n<h3>（2）SDS与C字符串的比较</h3>\n<p>SDS在C字符串的基础上加入了free和len字段，带来了很多好处：</p>\n<ul>\n<li>获取字符串长度：SDS是O(1)，C字符串是O(n)</li>\n<li>缓冲区溢出：使用C字符串的API时，如果字符串长度增加（如strcat操作）而忘记重新分配内存，很容易造成缓冲区的溢出；而SDS由于记录了长度，相应的API在可能造成缓冲区溢出时会自动重新分配内存，杜绝了缓冲区溢出。</li>\n<li>修改字符串时内存的重分配：对于C字符串，如果要修改字符串，必须要重新分配内存（先释放再申请），因为如果没有重新分配，字符串长度增大时会造成内存缓冲区溢出，字符串长度减小时会造成内存泄露。而对于SDS，由于可以记录len和free，因此解除了字符串长度和空间数组长度之间的关联，可以在此基础上进行优化：空间预分配策略（即分配内存时比实际需要的多）使得字符串长度增大时重新分配内存的概率大大减小；惰性空间释放策略使得字符串长度减小时重新分配内存的概率大大减小。</li>\n<li>存取二进制数据：SDS可以，C字符串不可以。因为C字符串以空字符作为字符串结束的标识，而对于一些二进制文件（如图片等），内容可能包括空字符串，因此C字符串无法正确存取；而SDS以字符串长度len来作为字符串结束标识，因此没有这个问题。</li>\n</ul>\n<p>此外，由于SDS中的buf仍然使用了C字符串（即以’\\0’结尾），因此SDS可以使用C字符串库中的部分函数；但是需要注意的是，只有当SDS用来存储文本数据时才可以这样使用，在存储二进制数据时则不行（’\\0’不一定是结尾）。</p>\n<h3>（3）SDS与C字符串的应用</h3>\n<p>Redis在存储对象时，一律使用SDS代替C字符串。例如set hello world命令，hello和world都是以SDS的形式存储的。而sadd myset member1 member2 member3命令，不论是键（”myset”），还是集合中的元素（”member1”、 ”member2”和”member3”），都是以SDS的形式存储。除了存储对象，SDS还用于存储各种缓冲区。</p>\n<p>只有在字符串不会改变的情况下，如打印日志时，才会使用C字符串。</p>\n<h1><a name=\"t4\"></a>四、Redis的对象类型与内部编码</h1>\n<p>前面已经说过，Redis支持5种对象类型，而每种结构都有至少两种编码；这样做的好处在于：一方面接口与实现分离，当需要增加或改变内部编码时，用户使用不受影响，另一方面可以根据不同的应用场景切换内部编码，提高效率。</p>\n<p>Redis各种对象类型支持的内部编码如下图所示(图中版本是Redis3.0，Redis后面版本中又增加了内部编码，略过不提；本章所介绍的内部编码都是基于3.0的)：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/28593c0d23953ad296b17967fa129871.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图片来源：《Redis设计与实现》</p>\n<p>关于Redis内部编码的转换，都符合以下规律：<strong>编码转换在</strong><strong>Redis</strong><strong>写入数据时完成，且转换过程不可逆，只能从小内存编码向大内存编码转换。</strong></p>\n<h2><a name=\"t41\"></a>1、字符串</h2>\n<h3>（1）概况</h3>\n<p>字符串是最基础的类型，因为所有的键都是字符串类型，且字符串之外的其他几种复杂类型的元素也是字符串。</p>\n<p>字符串长度不能超过512MB。</p>\n<h3>（2）内部编码</h3>\n<p>字符串类型的内部编码有3种，它们的应用场景如下：</p>\n<ul>\n<li>int：8个字节的长整型。字符串值是整型时，这个值使用long整型表示。</li>\n<li>embstr：&lt;=39字节的字符串。embstr与raw都使用redisObject和sds保存数据，区别在于，embstr的使用只分配一次内存空间（因此redisObject和sds是连续的），而raw需要分配两次内存空间（分别为redisObject和sds分配空间）。因此与raw相比，embstr的好处在于创建时少分配一次空间，删除时少释放一次空间，以及对象的所有数据连在一起，寻找方便。而embstr的坏处也很明显，如果字符串的长度增加需要重新分配内存时，整个redisObject和sds都需要重新分配空间，因此redis中的embstr实现为只读。</li>\n<li>raw：大于39个字节的字符串</li>\n</ul>\n<p>示例如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/671a709f884a9584f067c2dc7d588b59.png\" alt=\"\"></p>\n<p>embstr和raw进行区分的长度，是39；是因为redisObject的长度是16字节，sds的长度是9+字符串长度；因此当字符串长度是39时，embstr的长度正好是16+9+39=64，jemalloc正好可以分配64字节的内存单元。</p>\n<h3>（3）编码转换</h3>\n<p>当int数据不再是整数，或大小超过了long的范围时，自动转化为raw。</p>\n<p>而对于embstr，由于其实现是只读的，因此在对embstr对象进行修改时，都会先转化为raw再进行修改，因此，只要是修改embstr对象，修改后的对象一定是raw的，无论是否达到了39个字节。示例如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/46b394cc882ed056fdee8caf1237e4da.png\" alt=\"\"></p>\n<h2><a name=\"t42\"></a>2、列表</h2>\n<h3>（1）概况</h3>\n<p>列表（list）用来存储多个有序的字符串，每个字符串称为元素；一个列表可以存储2^32-1个元素。Redis中的列表支持两端插入和弹出，并可以获得指定位置（或范围）的元素，可以充当数组、队列、栈等。</p>\n<h3>（2）内部编码</h3>\n<p>列表的内部编码可以是压缩列表（ziplist）或双端链表（linkedlist）。</p>\n<p>双端链表：由一个list结构和多个listNode结构组成；典型结构如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/dc15e787d4b13a9944b821568afae17c.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图片来源：《Redis设计与实现》</p>\n<p>通过图中可以看出，双端链表同时保存了表头指针和表尾指针，并且每个节点都有指向前和指向后的指针；链表中保存了列表的长度；dup、free和match为节点值设置类型特定函数，所以链表可以用于保存各种不同类型的值。而链表中每个节点指向的是type为字符串的redisObject。</p>\n<p>压缩列表：压缩列表是Redis为了节约内存而开发的，是由一系列特殊编码的<strong>连续内存块</strong>(而不是像双端链表一样每个节点是指针)组成的顺序型数据结构；具体结构相对比较复杂，略。与双端链表相比，压缩列表可以节省内存空间，但是进行修改或增删操作时，复杂度较高；因此当节点数量较少时，可以使用压缩列表；但是节点数量多时，还是使用双端链表划算。</p>\n<p>压缩列表不仅用于实现列表，也用于实现哈希、有序列表；使用非常广泛。</p>\n<h3>（3）编码转换</h3>\n<p>只有同时满足下面两个条件时，才会使用压缩列表：列表中元素数量小于512个；列表中所有字符串对象都不足64字节。如果有一个条件不满足，则使用双端列表；且编码只可能由压缩列表转化为双端链表，反方向则不可能。</p>\n<p>下图展示了列表编码转换的特点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/aeea9b05c5e09cae19d2ee9ed2875285.png\" alt=\"\"></p>\n<p>其中，单个字符串不能超过64字节，是为了便于统一分配每个节点的长度；这里的64字节是指字符串的长度，不包括SDS结构，因为压缩列表使用连续、定长内存块存储字符串，不需要SDS结构指明长度。后面提到压缩列表，也会强调长度不超过64字节，原理与这里类似。</p>\n<h2><a name=\"t43\"></a>3、哈希</h2>\n<h3>（1）概况</h3>\n<p>哈希（作为一种数据结构），不仅是redis对外提供的5种对象类型的一种（与字符串、列表、集合、有序结合并列），也是Redis作为Key-Value数据库所使用的数据结构。为了说明的方便，在本文后面当使用“内层的哈希”时，代表的是redis对外提供的5种对象类型的一种；使用“外层的哈希”代指Redis作为Key-Value数据库所使用的数据结构。</p>\n<h3>（2）内部编码</h3>\n<p>内层的哈希使用的内部编码可以是压缩列表（ziplist）和哈希表（hashtable）两种；Redis的外层的哈希则只使用了hashtable。</p>\n<p>压缩列表前面已介绍。与哈希表相比，压缩列表用于元素个数少、元素长度小的场景；其优势在于集中存储，节省空间；同时，虽然对于元素的操作复杂度也由O(n)变为了O(1)，但由于哈希中元素数量较少，因此操作的时间并没有明显劣势。</p>\n<p>hashtable：一个hashtable由1个dict结构、2个dictht结构、1个dictEntry指针数组（称为bucket）和多个dictEntry结构组成。</p>\n<p>正常情况下（即hashtable没有进行rehash时）各部分关系如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/bade6592c75a4d693f8269dd3a9c5d85.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图片改编自：《Redis设计与实现》</p>\n<p>下面从底层向上依次介绍各个部分：</p>\n<p><strong>dictEntry</strong></p>\n<p>dictEntry结构用于保存键值对，结构定义如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac193903fcbf914920378\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntypedef struct dictEntry{\r\n    void *key;\r\n    union{\r\n        void *val;\r\n        uint64_tu64;\r\n        int64_ts64;\r\n    }v;\r\n    struct dictEntry *next;\r\n}dictEntry;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcbf914920378-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcbf914920378-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcbf914920378-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcbf914920378-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcbf914920378-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcbf914920378-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcbf914920378-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcbf914920378-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcbf914920378-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac193903fcbf914920378-1\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dictEntry</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcbf914920378-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcbf914920378-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">union</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcbf914920378-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcbf914920378-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">uint64_tu64</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcbf914920378-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">int64_ts64</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcbf914920378-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcbf914920378-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">dictEntry *</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcbf914920378-9\"><span class=\"crayon-sy\">}</span><span class=\"crayon-v\">dictEntry</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>其中，各个属性的功能如下：</p>\n<ul>\n<li>key：键值对中的键；</li>\n<li>val：键值对中的值，使用union(即共用体)实现，存储的内容既可能是一个指向值的指针，也可能是64位整型，或无符号64位整型；</li>\n<li>next：指向下一个dictEntry，用于解决哈希冲突问题</li>\n</ul>\n<p>在64位系统中，一个dictEntry对象占24字节（key/val/next各占8字节）。</p>\n<p><strong>bucket</strong></p>\n<p>bucket是一个数组，数组的每个元素都是指向dictEntry结构的指针。redis中bucket数组的大小计算规则如下：大于dictEntry的、最小的2^n；例如，如果有1000个dictEntry，那么bucket大小为1024；如果有1500个dictEntry，则bucket大小为2048。</p>\n<p><strong>dictht</strong></p>\n<p>dictht结构如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac193903fccb615319022\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntypedef struct dictht{\r\n    dictEntry **table;\r\n    unsigned long size;\r\n    unsigned long sizemask;\r\n    unsigned long used;\r\n}dictht;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac193903fccb615319022-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fccb615319022-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fccb615319022-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fccb615319022-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fccb615319022-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fccb615319022-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac193903fccb615319022-1\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dictht</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fccb615319022-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">dictEntry *</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fccb615319022-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fccb615319022-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sizemask</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fccb615319022-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">used</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fccb615319022-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-v\">dictht</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</div>\n<p>其中，各个属性的功能说明如下：</p>\n<ul>\n<li>table属性是一个指针，指向bucket；</li>\n<li>size属性记录了哈希表的大小，即bucket的大小；</li>\n<li>used记录了已使用的dictEntry的数量；</li>\n<li>sizemask属性的值总是为size-1，这个属性和哈希值一起决定一个键在table中存储的位置。</li>\n</ul>\n<p><strong>dict</strong></p>\n<p>一般来说，通过使用dictht和dictEntry结构，便可以实现普通哈希表的功能；但是Redis的实现中，在dictht结构的上层，还有一个dict结构。下面说明dict结构的定义及作用。</p>\n<p>dict结构如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac193903fcd0372736555\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntypedef struct dict{\r\n    dictType *type;\r\n    void *privdata;\r\n    dictht ht[2];\r\n    int trehashidx;\r\n} dict;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcd0372736555-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcd0372736555-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcd0372736555-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcd0372736555-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcd0372736555-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcd0372736555-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac193903fcd0372736555-1\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dict</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcd0372736555-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">dictType *</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcd0372736555-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">privdata</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcd0372736555-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">dictht </span><span class=\"crayon-v\">ht</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcd0372736555-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trehashidx</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcd0372736555-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dict</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p>其中，type属性和privdata属性是为了适应不同类型的键值对，用于创建多态字典。</p>\n<p>ht属性和trehashidx属性则用于rehash，即当哈希表需要扩展或收缩时使用。ht是一个包含两个项的数组，每项都指向一个dictht结构，这也是Redis的哈希会有1个dict、2个dictht结构的原因。通常情况下，所有的数据都是存在放dict的ht[0]中，ht[1]只在rehash的时候使用。dict进行rehash操作的时候，将ht[0]中的所有数据rehash到ht[1]中。然后将ht[1]赋值给ht[0]，并清空ht[1]。</p>\n<p>因此，Redis中的哈希之所以在dictht和dictEntry结构之外还有一个dict结构，一方面是为了适应不同类型的键值对，另一方面是为了rehash。</p>\n<h3>（3）编码转换</h3>\n<p>如前所述，Redis中内层的哈希既可能使用哈希表，也可能使用压缩列表。</p>\n<p>只有同时满足下面两个条件时，才会使用压缩列表：哈希中元素数量小于512个；哈希中所有键值对的键和值字符串长度都小于64字节。如果有一个条件不满足，则使用哈希表；且编码只可能由压缩列表转化为哈希表，反方向则不可能。</p>\n<p>下图展示了Redis内层的哈希编码转换的特点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/0a98910371a2157072c25fcf2b7f6784.png\" alt=\"\"></p>\n<h2><a name=\"t44\"></a>4、集合</h2>\n<h3>（1）概况</h3>\n<p>集合（set）与列表类似，都是用来保存多个字符串，但集合与列表有两点不同：集合中的元素是无序的，因此不能通过索引来操作元素；集合中的元素不能有重复。</p>\n<p>一个集合中最多可以存储2^32-1个元素；除了支持常规的增删改查，Redis还支持多个集合取交集、并集、差集。</p>\n<h3>（2）内部编码</h3>\n<p>集合的内部编码可以是整数集合（intset）或哈希表（hashtable）。</p>\n<p>哈希表前面已经讲过，这里略过不提；需要注意的是，集合在使用哈希表时，值全部被置为null。</p>\n<p>整数集合的结构定义如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac193903fcd5950225888\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntypedef struct intset{\r\n    uint32_t encoding;\r\n    uint32_t length;\r\n    int8_t contents[];\r\n} intset;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcd5950225888-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcd5950225888-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcd5950225888-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcd5950225888-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcd5950225888-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac193903fcd5950225888-1\"><span class=\"crayon-r\">typedef</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">intset</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcd5950225888-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">uint32_t </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcd5950225888-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">uint32_t </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcd5950225888-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">int8_t </span><span class=\"crayon-v\">contents</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcd5950225888-5\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">intset</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>其中，encoding代表contents中存储内容的类型，虽然contents（存储集合中的元素）是int8_t类型，但实际上其存储的值是int16_t、int32_t或int64_t，具体的类型便是由encoding决定的；length表示元素个数。</p>\n<p>整数集合适用于集合所有元素都是整数且集合元素数量较小的时候，与哈希表相比，整数集合的优势在于集中存储，节省空间；同时，虽然对于元素的操作复杂度也由O(n)变为了O(1)，但由于集合数量较少，因此操作的时间并没有明显劣势。</p>\n<h3>（3）编码转换</h3>\n<p>只有同时满足下面两个条件时，集合才会使用整数集合：集合中元素数量小于512个；集合中所有元素都是整数值。如果有一个条件不满足，则使用哈希表；且编码只可能由整数集合转化为哈希表，反方向则不可能。</p>\n<p>下图展示了集合编码转换的特点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/c5dcfed49dff9c771a6929455d548f81.png\" alt=\"\"></p>\n<h2><a name=\"t45\"></a>5、有序集合</h2>\n<h3>（1）概况</h3>\n<p>有序集合与集合一样，元素都不能重复；但与集合不同的是，有序集合中的元素是有顺序的。与列表使用索引下标作为排序依据不同，有序集合为每个元素设置一个分数（score）作为排序依据。</p>\n<h3>（2）内部编码</h3>\n<p>有序集合的内部编码可以是压缩列表（ziplist）或跳跃表（skiplist）。ziplist在列表和哈希中都有使用，前面已经讲过，这里略过不提。</p>\n<p>跳跃表是一种有序数据结构，通过在每个节点中维持多个指向其他节点的指针，从而达到快速访问节点的目的。除了跳跃表，实现有序数据结构的另一种典型实现是平衡树；大多数情况下，跳跃表的效率可以和平衡树媲美，且跳跃表实现比平衡树简单很多，因此redis中选用跳跃表代替平衡树。跳跃表支持平均O(logN)、最坏O(N)的复杂点进行节点查找，并支持顺序操作。Redis的跳跃表实现由zskiplist和zskiplistNode两个结构组成：前者用于保存跳跃表信息（如头结点、尾节点、长度等），后者用于表示跳跃表节点。具体结构相对比较复杂，略。</p>\n<h3>（3）编码转换</h3>\n<p>只有同时满足下面两个条件时，才会使用压缩列表：有序集合中元素数量小于128个；有序集合中所有成员长度都不足64字节。如果有一个条件不满足，则使用跳跃表；且编码只可能由压缩列表转化为跳跃表，反方向则不可能。</p>\n<p>下图展示了有序集合编码转换的特点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/ec94bc8c186973c1318a5c439729eacb.png\" alt=\"\"></p>\n<h1><a name=\"t5\"></a>五、应用举例</h1>\n<p>了解Redis的内存模型之后，下面通过几个例子说明其应用。</p>\n<h2><a name=\"t51\"></a>1、估算Redis内存使用量</h2>\n<p>要估算redis中的数据占据的内存大小，需要对redis的内存模型有比较全面的了解，包括前面介绍的hashtable、sds、redisobject、各种对象类型的编码方式等。</p>\n<p>下面以最简单的字符串类型来进行说明。</p>\n<p>假设有90000个键值对，每个key的长度是7个字节，每个value的长度也是7个字节（且key和value都不是整数）；下面来估算这90000个键值对所占用的空间。在估算占据空间之前，首先可以判定字符串类型使用的编码方式：embstr。</p>\n<p>90000个键值对占据的内存空间主要可以分为两部分：一部分是90000个dictEntry占据的空间；一部分是键值对所需要的bucket空间。</p>\n<p>每个dictEntry占据的空间包括：</p>\n<p>1)       一个dictEntry，24字节，jemalloc会分配32字节的内存块</p>\n<p>2)       一个key，7字节，所以SDS(key)需要7+9=16个字节，jemalloc会分配16字节的内存块</p>\n<p>3)       一个redisObject，16字节，jemalloc会分配16字节的内存块</p>\n<p>4)       一个value，7字节，所以SDS(value)需要7+9=16个字节，jemalloc会分配16字节的内存块</p>\n<p>5)       综上，一个dictEntry需要32+16+16+16=80个字节。</p>\n<p>bucket空间：bucket数组的大小为大于90000的最小的2^n，是131072；每个bucket元素为8字节（因为64位系统中指针大小为8字节）。</p>\n<p>因此，可以估算出这90000个键值对占据的内存大小为：90000*80 + 131072*8 = 8248576。</p>\n<p>下面写个程序在redis中验证一下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac193903fcdd525710191\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class RedisTest {\r\n \r\n　　public static Jedis jedis = new Jedis(\"localhost\", 6379);\r\n \r\n　　public static void main(String[] args) throws Exception{\r\n　　　　Long m1 = Long.valueOf(getMemory());\r\n　　　　insertData();\r\n　　　　Long m2 = Long.valueOf(getMemory());\r\n　　　　System.out.println(m2 - m1);\r\n　　}\r\n \r\n　　public static void insertData(){\r\n　　　　for(int i = 10000; i &lt; 100000; i++){\r\n　　　　　　jedis.set(\"aa\" + i, \"aa\" + i); //key和value长度都是7字节，且不是整数\r\n　　　　}\r\n　　}\r\n \r\n　　public static String getMemory(){\r\n　　　　String memoryAllLine = jedis.info(\"memory\");\r\n　　　　String usedMemoryLine = memoryAllLine.split(\"\\r\\n\")[1];\r\n　　　　String memory = usedMemoryLine.substring(usedMemoryLine.indexOf(':') + 1);\r\n　　　　return memory;\r\n　　}\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcdd525710191-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcdd525710191-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcdd525710191-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcdd525710191-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcdd525710191-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcdd525710191-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcdd525710191-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcdd525710191-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcdd525710191-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcdd525710191-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcdd525710191-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcdd525710191-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcdd525710191-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcdd525710191-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcdd525710191-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcdd525710191-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcdd525710191-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcdd525710191-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcdd525710191-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcdd525710191-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcdd525710191-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcdd525710191-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fcdd525710191-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fcdd525710191-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac193903fcdd525710191-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisTest</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcdd525710191-2\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcdd525710191-3\">　　<span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Jedis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"localhost\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcdd525710191-4\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcdd525710191-5\">　　<span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcdd525710191-6\">　　　　<span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">getMemory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcdd525710191-7\">　　　　<span class=\"crayon-e\">insertData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcdd525710191-8\">　　　　<span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">getMemory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcdd525710191-9\">　　　　<span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcdd525710191-10\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcdd525710191-11\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcdd525710191-12\">　　<span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insertData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcdd525710191-13\">　　　　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcdd525710191-14\">　　　　　　<span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"aa\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"aa\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//key和value长度都是7字节，且不是整数</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcdd525710191-15\">　　　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcdd525710191-16\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcdd525710191-17\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcdd525710191-18\">　　<span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getMemory</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcdd525710191-19\">　　　　<span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">memoryAllLine</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"memory\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcdd525710191-20\">　　　　<span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">usedMemoryLine</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">memoryAllLine</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcdd525710191-21\">　　　　<span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">memory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">usedMemoryLine</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">usedMemoryLine</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">indexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">':'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcdd525710191-22\">　　　　<span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">memory</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fcdd525710191-23\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fcdd525710191-24\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0049 seconds] -->\r\n<p>运行结果：8247552</p>\n<p>理论值与结果值误差在万分之1.2，对于计算需要多少内存来说，这个精度已经足够了。之所以会存在误差，是因为在我们插入90000条数据之前redis已分配了一定的bucket空间，而这些bucket空间尚未使用。</p>\n<p>作为对比将key和value的长度由7字节增加到8字节，则对应的SDS变为17个字节，jemalloc会分配32个字节，因此每个dictEntry占用的字节数也由80字节变为112字节。此时估算这90000个键值对占据内存大小为：90000*112 + 131072*8 = 11128576。</p>\n<p>在redis中验证代码如下（只修改插入数据的代码）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac193903fce4591830250\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic static void insertData(){\r\n　　for(int i = 10000; i &lt; 100000; i++){\r\n　　　　jedis.set(\"aaa\" + i, \"aaa\" + i); //key和value长度都是8字节，且不是整数\r\n　　}\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac193903fce4591830250-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fce4591830250-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fce4591830250-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac193903fce4591830250-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac193903fce4591830250-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac193903fce4591830250-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insertData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fce4591830250-2\">　　<span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fce4591830250-3\">　　　　<span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"aaa\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"aaa\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//key和value长度都是8字节，且不是整数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac193903fce4591830250-4\">　　<span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5ac193903fce4591830250-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>运行结果：11128576；估算准确。</p>\n<p>对于字符串类型之外的其他类型，对内存占用的估算方法是类似的，需要结合具体类型的编码方式来确定。</p>\n<h2><a name=\"t52\"></a>2、优化内存占用</h2>\n<p>了解redis的内存模型，对优化redis内存占用有很大帮助。下面介绍几种优化场景。</p>\n<p>（1）利用jemalloc特性进行优化</p>\n<p>上一小节所讲述的90000个键值便是一个例子。由于jemalloc分配内存时数值是不连续的，因此key/value字符串变化一个字节，可能会引起占用内存很大的变动；在设计时可以利用这一点。</p>\n<p>例如，如果key的长度如果是8个字节，则SDS为17字节，jemalloc分配32字节；此时将key长度缩减为7个字节，则SDS为16字节，jemalloc分配16字节；则每个key所占用的空间都可以缩小一半。</p>\n<p>（2）使用整型/长整型</p>\n<p>如果是整型/长整型，Redis会使用int类型（8字节）存储来代替字符串，可以节省更多空间。因此在可以使用长整型/整型代替字符串的场景下，尽量使用长整型/整型。</p>\n<p>（3）共享对象</p>\n<p>利用共享对象，可以减少对象的创建（同时减少了redisObject的创建），节省内存空间。目前redis中的共享对象只包括10000个整数（0-9999）；可以通过调整REDIS_SHARED_INTEGERS参数提高共享对象的个数；例如将REDIS_SHARED_INTEGERS调整到20000，则0-19999之间的对象都可以共享。</p>\n<p>考虑这样一种场景：论坛网站在redis中存储了每个帖子的浏览数，而这些浏览数绝大多数分布在0-20000之间，这时候通过适当增大REDIS_SHARED_INTEGERS参数，便可以利用共享对象节省内存空间。</p>\n<p>（4）避免过度设计</p>\n<p>然而需要注意的是，不论是哪种优化场景，都要考虑内存空间与设计复杂度的权衡；而设计复杂度会影响到代码的复杂度、可维护性。</p>\n<p>如果数据量较小，那么为了节省内存而使得代码的开发、维护变得更加困难并不划算；还是以前面讲到的90000个键值对为例，实际上节省的内存空间只有几MB。但是如果数据量有几千万甚至上亿，考虑内存的优化就比较必要了。</p>\n<h2><a name=\"t53\"></a>3、关注内存碎片率</h2>\n<p>内存碎片率是一个重要的参数，对redis 内存的优化有重要意义。</p>\n<p>如果内存碎片率过高（jemalloc在1.03左右比较正常），说明内存碎片多，内存浪费严重；这时便可以考虑重启redis服务，在内存中对数据进行重排，减少内存碎片。</p>\n<p>如果内存碎片率小于1，说明redis内存不足，部分数据使用了虚拟内存（即swap）；由于虚拟内存的存取速度比物理内存差很多（2-3个数量级），此时redis的访问速度可能会变得很慢。因此必须设法增大物理内存（可以增加服务器节点数量，或提高单机内存），或减少redis中的数据。</p>\n<p>要减少redis中的数据，除了选用合适的数据类型、利用共享对象等，还有一点是要设置合理的数据回收策略（maxmemory-policy），当内存达到一定量后，根据不同的优先级对内存进行回收。</p>\n<h1><a name=\"t6\"></a>六、参考文献</h1>\n<p>《Redis开发与运维》</p>\n<p>《Redis设计与实现》</p>\n<p>https://redis.io/documentation</p>\n<p>http://redisdoc.com/server/info.html</p>\n<p>https://www.cnblogs.com/lhcpig/p/4769397.html</p>\n<p>https://searchdatabase.techtarget.com.cn/7-20218/</p>\n<p>http://www.cnblogs.com/mushroom/p/4738170.html</p>\n<p>http://www.imooc.com/article/3645</p>\n<p>http://blog.csdn.net/zhengpeitao/article/details/76573053</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113789\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113789votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113789\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "d7679705b6786b2bb8061b616470a651"},{"title": "给 “rm” 命令添加个“垃圾桶”", "create_date": "2018/03/11 ·", "url": "http://blog.jobbole.com/113737/", "front_image": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "like": 1, "comment": 1, "collect": 3, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.2daygeek.com/rm-command-to-move-files-to-trash-can-rm-alias/\">2daygeek</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9425-1.html\">Linux中国/amwps290</a>   </div><p>人类犯错误是因为我们不是一个可编程设备，所以，在使用 <code>rm</code> 命令时要额外注意，不要在任何时候使用 <code>rm -rf *</code>。当你使用 <code>rm</code> 命令时，它会永久删除文件，不会像文件管理器那样将这些文件移动到 “垃圾箱”。</p>\n<p>有时我们会将不应该删除的文件删除掉，所以当错误地删除了文件时该怎么办？ 你必须看看恢复工具（Linux 中有很多数据恢复工具），但我们不知道是否能将它百分之百恢复，所以要如何解决这个问题？</p>\n<p>我们最近发表了一篇关于 <a href=\"https://www.2daygeek.com/trash-cli-command-line-trashcan-linux-system/\">Trash-Cli</a> 的文章，在评论部分，我们从用户 Eemil Lgz 那里获得了一个关于 <a href=\"https://github.com/lagerspetz/linux-stuff/blob/master/scripts/saferm.sh\">saferm.sh</a> 脚本的更新，它可以帮助我们将文件移动到“垃圾箱”而不是永久删除它们。</p>\n<p>将文件移动到“垃圾桶”是一个好主意，当你无意中运行 <code>rm</code> 命令时，可以拯救你；但是很少有人会说这是一个坏习惯，如果你不注意“垃圾桶”，它可能会在一定的时间内被文件和文件夹堆积起来。在这种情况下，我建议你按照你的意愿去做一个定时任务。</p>\n<p>这适用于服务器和桌面两种环境。 如果脚本检测到 GNOME 、KDE、Unity 或 LXDE 桌面环境（DE），则它将文件或文件夹安全地移动到默认垃圾箱 <code>$HOME/.local/share/Trash/files</code>，否则会在您的主目录中创建垃圾箱文件夹 <code>$HOME/Trash</code>。</p>\n<p><code>saferm.sh</code> 脚本托管在 Github 中，可以从仓库中克隆，也可以创建一个名为 <code>saferm.sh</code> 的文件并复制其上的代码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac14fb5c2154080687941\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git clone https://github.com/lagerspetz/linux-stuff\r\n$ sudo mv linux-stuff/scripts/saferm.sh /bin\r\n$ rm -Rf linux-stuff\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c2154080687941-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c2154080687941-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c2154080687941-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c2154080687941-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac14fb5c2154080687941-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/lagerspetz/linux-stuff</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c2154080687941-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">linux</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">stuff</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">scripts</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">saferm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">bin</span></div><div class=\"crayon-line\" id=\"crayon-5ac14fb5c2154080687941-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Rf </span><span class=\"crayon-v\">linux</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">stuff</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c2154080687941-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>在 <code>.bashrc</code> 文件中设置别名，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac14fb5c2160016726403\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalias rm=saferm.sh\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c2160016726403-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c2160016726403-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac14fb5c2160016726403-1\"><span class=\"crayon-e\">alias </span><span class=\"crayon-v\">rm</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">saferm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c2160016726403-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>执行下面的命令使其生效，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac14fb5c2164522839920\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ source ~/.bashrc\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c2164522839920-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c2164522839920-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac14fb5c2164522839920-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">bashrc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c2164522839920-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>一切就绪，现在你可以执行 <code>rm</code> 命令，自动将文件移动到”垃圾桶”，而不是永久删除它们。</p>\n<p>测试一下，我们将删除一个名为 <code>magi.txt</code> 的文件，命令行明确的提醒了 <code>Moving magi.txt to $HOME/.local/share/Trash/file</code>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac14fb5c2168528061880\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ rm -rf magi.txt\r\nMoving magi.txt to /home/magi/.local/share/Trash/files\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c2168528061880-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c2168528061880-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c2168528061880-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac14fb5c2168528061880-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">rf </span><span class=\"crayon-v\">magi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c2168528061880-2\"><span class=\"crayon-e\">Moving </span><span class=\"crayon-v\">magi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">magi</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">share</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Trash</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">files</span></div><div class=\"crayon-line\" id=\"crayon-5ac14fb5c2168528061880-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>也可以通过 <code>ls</code> 命令或 <code>trash-cli</code> 进行验证。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac14fb5c216b596366743\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls -lh /home/magi/.local/share/Trash/files\r\nPermissions Size User Date Modified Name\r\n.rw-r--r-- 32 magi 11 Oct 16:24 magi.txt    \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c216b596366743-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c216b596366743-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c216b596366743-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c216b596366743-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac14fb5c216b596366743-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">magi</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">share</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Trash</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">files</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c216b596366743-2\"><span class=\"crayon-e\">Permissions </span><span class=\"crayon-e\">Size </span><span class=\"crayon-e\">User </span><span class=\"crayon-e\">Date </span><span class=\"crayon-e\">Modified </span><span class=\"crayon-i\">Name</span></div><div class=\"crayon-line\" id=\"crayon-5ac14fb5c216b596366743-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">magi</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Oct</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">magi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c216b596366743-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>或者我们可以通过文件管理器界面中查看相同的内容。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/a21377f62f1d9e9057d4bd7380a6acf7.png\" alt=\"![][3]\"></p>\n<p>（LCTT 译注：原文此处混淆了部分 trash-cli 的内容，考虑到文章衔接和逻辑，此处略。）</p>\n<p>要了解 <code>saferm.sh</code> 的其他选项，请查看帮助。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac14fb5c216f418492588\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ saferm.sh -h\r\nThis is saferm.sh 1.16. LXDE and Gnome3 detection.\r\nWill ask to unsafe-delete instead of cross-fs move. Allows unsafe (regular rm) delete (ignores trashinfo).\r\nCreates trash and trashinfo directories if they do not exist. Handles symbolic link deletion.\r\nDoes not complain about different user any more.\r\n\r\nUsage: /path/to/saferm.sh [OPTIONS] [--] files and dirs to safely remove\r\nOPTIONS:\r\n-r      allows recursively removing directories.\r\n-f      Allow deleting special files (devices, ...).\r\n-u      Unsafe mode, bypass trash and delete files permanently.\r\n-v      Verbose, prints more messages. Default in this version.\r\n-q      Quiet mode. Opposite of verbose.\r\n\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c216f418492588-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c216f418492588-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c216f418492588-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c216f418492588-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c216f418492588-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c216f418492588-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c216f418492588-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c216f418492588-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c216f418492588-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c216f418492588-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c216f418492588-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c216f418492588-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c216f418492588-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac14fb5c216f418492588-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5ac14fb5c216f418492588-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac14fb5c216f418492588-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saferm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c216f418492588-2\"><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saferm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.16.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LXDE </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Gnome3 </span><span class=\"crayon-v\">detection</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ac14fb5c216f418492588-3\"><span class=\"crayon-e\">Will </span><span class=\"crayon-e\">ask </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unsafe</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">delete </span><span class=\"crayon-e\">instead </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">cross</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">fs </span><span class=\"crayon-v\">move</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Allows </span><span class=\"crayon-e\">unsafe</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">regular </span><span class=\"crayon-v\">rm</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">ignores </span><span class=\"crayon-v\">trashinfo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c216f418492588-4\"><span class=\"crayon-e\">Creates </span><span class=\"crayon-e\">trash </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">trashinfo </span><span class=\"crayon-e\">directories </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">they </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exist</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Handles </span><span class=\"crayon-e\">symbolic </span><span class=\"crayon-e\">link </span><span class=\"crayon-v\">deletion</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ac14fb5c216f418492588-5\"><span class=\"crayon-e\">Does </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">complain </span><span class=\"crayon-e\">about </span><span class=\"crayon-e\">different </span><span class=\"crayon-e\">user </span><span class=\"crayon-e\">any </span><span class=\"crayon-v\">more</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c216f418492588-6\"> </div><div class=\"crayon-line\" id=\"crayon-5ac14fb5c216f418492588-7\"><span class=\"crayon-v\">Usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">saferm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">OPTIONS</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">files </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dirs </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">safely </span><span class=\"crayon-e\">remove</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c216f418492588-8\"><span class=\"crayon-v\">OPTIONS</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5ac14fb5c216f418492588-9\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\">      </span><span class=\"crayon-e\">allows </span><span class=\"crayon-e\">recursively </span><span class=\"crayon-e\">removing </span><span class=\"crayon-v\">directories</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c216f418492588-10\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\">      </span><span class=\"crayon-e\">Allow </span><span class=\"crayon-e\">deleting </span><span class=\"crayon-e\">special </span><span class=\"crayon-e\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">devices</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ac14fb5c216f418492588-11\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\">      </span><span class=\"crayon-e\">Unsafe </span><span class=\"crayon-v\">mode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bypass </span><span class=\"crayon-e\">trash </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">delete </span><span class=\"crayon-e\">files </span><span class=\"crayon-v\">permanently</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c216f418492588-12\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\">      </span><span class=\"crayon-v\">Verbose</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">prints </span><span class=\"crayon-e\">more </span><span class=\"crayon-v\">messages</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">Default</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">version</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5ac14fb5c216f418492588-13\"><span class=\"crayon-o\">-</span><span class=\"crayon-i\">q</span><span class=\"crayon-h\">      </span><span class=\"crayon-e\">Quiet </span><span class=\"crayon-v\">mode</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Opposite </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">verbose</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac14fb5c216f418492588-14\"> </div><div class=\"crayon-line\" id=\"crayon-5ac14fb5c216f418492588-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0059 seconds] -->\r\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113737\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113737votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113737\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "44f879688ac007f05bd74cdf86522e39"},{"title": "如何在 Linux 上安装应用程序", "create_date": "2018/03/27 ·", "url": "http://blog.jobbole.com/113793/", "front_image": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "like": 1, "comment": 1, "collect": 2, "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/1/how-install-apps-linux\">Seth Kenlon</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9486-1.html\">Linux中国/MjSeven</a>   </div><blockquote><p>学习在你的 Linux 计算机上摆弄那些软件。</p></blockquote>\n<p>如何在 Linux 上安装应用程序？因为有许多操作系统，这个问题不止有一个答案。应用程序可以可以来自许多来源 —— 几乎不可能数的清，并且每个开发团队都可以以他们认为最好的方式提供软件。知道如何安装你所得到的软件是成为操作系统高级用户的一部分。</p>\n<h3 id=\"toc_1\">仓库</h3>\n<p>十多年来，Linux 已经在使用软件库来分发软件。在这种情况下，“仓库”是一个托管可安装软件包的公共服务器。Linux 发行版提供了一条命令，以及该命令的图形界面，用于从服务器获取软件并将其安装到你的计算机。这是一个非常简单的概念，它已经成为所有主流手机操作系统的模式，最近，该模式也成为了两大闭源计算机操作系统的“应用商店”。</p>\n<p><img class=\"aligncenter\" title=\"Linux repository\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/760b92cca45081c6804cd6aaed0a77cc.png\" alt=\"Linux repository\"></p>\n<p style=\"text-align: center\"><em>不是应用程序商店</em></p>\n<p>从软件仓库安装是在 Linux 上安装应用程序的主要方法，它应该是你寻找想要安装的任何应用程序的首选地方。</p>\n<p>从软件仓库安装，通常需要一个命令，如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac191ed03c69733242585\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo dnf install inkscape\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c69733242585-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03c69733242585-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac191ed03c69733242585-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">inkscape</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03c69733242585-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>实际使用的命令取决于你所使用的 Linux 发行版。Fedora 使用 <code>dnf</code>，OpenSUSE 使用 <code>zypper</code>，Debian 和 Ubuntu 使用 <code>apt</code>，Slackware 使用 <code>sbopkg</code>，FreeBSD 使用 <code>pkg_add</code>，而基于 lllumos 的 Openlndiana 使用 <code>pkg</code>。无论你使用什么，该命令通常要搜索你想要安装应用程序的正确名称，因为有时候你认为的软件名称不是它官方或独有的名称：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac191ed03c77220909527\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo dnf search pyqt\r\nPyQt.x86_64 : Python bindings for Qt3\r\nPyQt4.x86_64 : Python bindings for Qt4\r\npython-qt5.x86_64 : PyQt5 is Python bindings for Qt5\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c77220909527-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03c77220909527-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c77220909527-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03c77220909527-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c77220909527-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac191ed03c77220909527-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-e\">search </span><span class=\"crayon-e\">pyqt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03c77220909527-2\"><span class=\"crayon-v\">PyQt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">x86_64</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Python </span><span class=\"crayon-e\">bindings </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Qt3</span></div><div class=\"crayon-line\" id=\"crayon-5ac191ed03c77220909527-3\"><span class=\"crayon-v\">PyQt4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">x86_64</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Python </span><span class=\"crayon-e\">bindings </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Qt4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03c77220909527-4\"><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">qt5</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">x86_64</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PyQt5 </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Python </span><span class=\"crayon-e\">bindings </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Qt5</span></div><div class=\"crayon-line\" id=\"crayon-5ac191ed03c77220909527-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>一旦你找到要安装的软件包的名称后，使用 <code>install</code> 子命令执行实际的下载和自动安装：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac191ed03c7e791939727\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo dnf install python-qt5\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c7e791939727-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03c7e791939727-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac191ed03c7e791939727-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">qt5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03c7e791939727-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>有关从软件仓库安装的具体信息，请参阅你的 Linux 发行版的文档。</p>\n<p>图形工具通常也是如此。搜索你认为你想要的，然后安装它。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/b69db96d52abf01b5c5bca4a7945bcb0.png\" alt=\"\"></p>\n<p>与底层命令一样，图形安装程序的名称取决于你正在运行的 Linux 发行版。相关的应用程序通常使用“软件（software）”或“包（package）”等关键字进行标记，因此请在你的启动项或菜单中搜索这些词汇，然后你将找到所需的内容。 由于开源全由用户来选择，所以如果你不喜欢你的发行版提供的图形用户界面（GUI），那么你可以选择安装替代品。 你知道该如何做到这一点。</p>\n<h4 id=\"toc_2\">额外仓库</h4>\n<p>你的 Linux 发行版为其打包的软件提供了标准仓库，通常也有额外的仓库。例如，<a href=\"https://fedoraproject.org/wiki/EPEL\">EPEL</a> 服务于 Red Hat Enterprise Linux 和 CentOS，<a href=\"http://rpmfusion.org\">RPMFusion</a> 服务于 Fedora，Ubuntu 有各种级别的支持以及个人包存档（PPA），<a href=\"http://packman.links2linux.org/\">Packman</a> 为 OpenSUSE 提供额外的软件以及 <a href=\"http://slackbuilds.org\">SlackBuilds.org</a> 为 Slackware 提供社区构建脚本。</p>\n<p>默认情况下，你的 Linux 操作系统设置为只查看其官方仓库，因此如果你想使用其他软件集合，则必须自己添加额外库。你通常可以像安装软件包一样安装仓库。实际上，当你安装例如 <a href=\"https://ring.cx/en/download/gnu-linux\">GNU Ring</a> 视频聊天，<a href=\"http://vivaldi.com\">Vivaldi</a> web 浏览器，谷歌浏览器等许多软件时，你的实际安装是访问他们的私有仓库，从中将最新版本的应用程序安装到你的机器上。</p>\n<p><img class=\"aligncenter\" title=\"Installing a repo\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/9c5806b523c1a55ae242c8aa66c46bcc.png\" alt=\"Installing a repo\"></p>\n<p style=\"text-align: center\"><em>安装仓库</em></p>\n<p>你还可以通过编辑文本文件将仓库手动添加到你的软件包管理器的配置目录，或者运行命令来添加添加仓库。像往常一样，你使用的确切命令取决于 Linux 发行版本。例如，这是一个 <code>dnf</code> 命令，它将一个仓库添加到系统中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac191ed03c86675531254\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo dnf config-manager --add-repo=http://example.com/pub/centos/7\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c86675531254-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03c86675531254-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac191ed03c86675531254-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">config</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">manager</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">add</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">repo</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//example.com/pub/centos/7</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03c86675531254-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_3\">不使用仓库来安装应用程序</h3>\n<p>仓库模型非常流行，因为它提供了用户（你）和开发人员之间的链接。重要更新发布之后，系统会提示你接受更新，并且你可以从一个集中位置接受所有更新。</p>\n<p>然而，有时候一个软件包还没有放到仓库中时。这些安装包有几种形式。</p>\n<h4 id=\"toc_4\">Linux 包</h4>\n<p>有时候，开发人员会以通用的 Linux 打包格式分发软件，例如 RPM、DEB 或较新但非常流行的 FlatPak 或 Snap 格式。你不是访问仓库下载的，你只是得到了这个包。</p>\n<p>例如，视频编辑器 <a href=\"https://www.lwks.com/\">Lightworks</a> 为 APT 用户提供了一个 <code>.deb</code> 文件，RPM 用户提供了 <code>.rpm</code> 文件。当你想要更新时，可以到网站下载最新的适合的文件。</p>\n<p>这些一次性软件包可以使用从仓库进行安装时所用的一样的工具进行安装。如果双击下载的软件包，图形安装程序将启动并逐步完成安装过程。</p>\n<p>或者，你可以从终端进行安装。这里的区别在于你从互联网下载的独立包文件不是来自仓库。这是一个“本地”安装，这意味着你的软件安装包不需要下载来安装。大多数软件包管理器都是透明处理的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac191ed03c8d555817213\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo dnf install ~/Downloads/lwks-14.0.0-amd64.rpm\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c8d555817213-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03c8d555817213-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac191ed03c8d555817213-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Downloads</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lwks</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">14.0.0</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">amd64</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">rpm</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03c8d555817213-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在某些情况下，你需要采取额外的步骤才能使应用程序运行，因此请仔细阅读有关你正在安装软件的文档。</p>\n<h4 id=\"toc_5\">通用安装脚本</h4>\n<p>一些开发人员以几种通用格式发布他们的包。常见的扩展名包括 <code>.run</code> 和 <code>.sh</code>。NVIDIA 显卡驱动程序、像 Nuke 和 Mari 这样的 Foundry visual FX 软件包以及来自 <a href=\"http://gog.com\">GOG</a> 的许多非 DRM 游戏都是用这种安装程序。（LCTT 译注：DRM 是数字版权管理。）</p>\n<p>这种安装模式依赖于开发人员提供安装“向导”。一些安装程序是图形化的，而另一些只是在终端中运行。</p>\n<p>有两种方式来运行这些类型的安装程序。</p>\n<p>1、 你可以直接从终端运行安装程序：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac191ed03c93869440592\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sh ./game/gog_warsow_x.y.z.sh\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c93869440592-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03c93869440592-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac191ed03c93869440592-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">game</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">gog_warsow_x</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">z</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03c93869440592-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>2、 另外，你可以通过标记其为可执行文件来运行它。要标记为安装程序可执行文件，右键单击它的图标并选择其属性。</p>\n<p><img class=\"aligncenter\" title=\"Giving an installer executable permission\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/819db3a7089befb230a5c94d66686b4c.jpg\" alt=\"Giving an installer executable permission\"></p>\n<p style=\"text-align: center\"><em>给安装程序可执行权限。</em></p>\n<p>一旦你允许其运行，双击图标就可以安装了。</p>\n<p><img class=\"aligncenter\" title=\"GOG installer\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/53afe89b824042f9a90daabea5e29cba.jpg\" alt=\"GOG installer\"></p>\n<p style=\"text-align: center\"><em>GOG 安装程序</em></p>\n<p>对于其余的安装程序，只需要按照屏幕上的说明进行操作。</p>\n<h4 id=\"toc_6\">AppImage 便携式应用程序</h4>\n<p>AppImage 格式对于 Linux 相对来说比较新，尽管它的概念是基于 NeXT 和 Rox 的。这个想法很简单：运行应用程序所需的一切都应该放在一个目录中，然后该目录被视为一个“应用程序”。要运行该应用程序，只需双击该图标即可运行。不需要也要不应该把应用程序安装在传统意义的地方；它从你在硬盘上的任何地方运行都行。</p>\n<p>尽管它可以作为独立应用运行，但 AppImage 通常提供一些系统集成。</p>\n<p><img class=\"aligncenter\" title=\"AppImage system integration\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/59ee2073d407653a05fa297c873d7446.png\" alt=\"AppImage system integration\"></p>\n<p style=\"text-align: center\"><em>AppImage 系统集成</em></p>\n<p>如果你接受此条件，则将一个本地的 <code>.desktop</code> 文件安装到你的主目录。<code>.desktop</code> 文件是 Linux 桌面的应用程序菜单和 mimetype 系统使用的一个小配置文件。实质上，只是将桌面配置文件放置在主目录的应用程序列表中“安装”应用程序，而不实际安装它。你获得了安装某些东西的所有好处，以及能够在本地运行某些东西的好处，即“便携式应用程序”。</p>\n<h4 id=\"toc_7\">应用程序目录</h4>\n<p>有时，开发人员只是编译一个应用程序，然后将结果发布到下载中，没有安装脚本，也没有打包。通常，这意味着你下载了一个 TAR 文件，然后 <a href=\"https://opensource.com/article/17/7/how-unzip-targz-file\">解压缩</a>，然后双击可执行文件（通常是你下载软件的名称）。</p>\n<p><img class=\"aligncenter\" title=\"Twine downloaded for Linux\" src=\"http://jbcdn2.b0.upaiyun.com/2018/03/8ebbfff11cc8cda27c3cacbbc6fa7f4f.jpg\" alt=\"Twine downloaded for Linux\"></p>\n<p style=\"text-align: center\"><em>下载 Twine</em></p>\n<p>当使用这种软件方式交付时，你可以将它放在你下载的地方，当你需要它时，你可以手动启动它，或者你可以自己进行快速但是麻烦的安装。这包括两个简单的步骤：</p>\n<ol>\n<li>将目录保存到一个标准位置，并在需要时手动启动它。</li>\n<li>将目录保存到一个标准位置，并创建一个 <code>.desktop</code> 文件，将其集成到你的系统中。</li>\n</ol>\n<p>如果你只是为自己安装应用程序，那么传统上会在你的主目录中放个 <code>bin</code> （“二进制文件binary” 的简称）目录作为本地安装的应用程序和脚本的存储位置。如果你的系统上有其他用户需要访问这些应用程序，传统上将二进制文件放置在 <code>/opt</code> 中。最后，这取决于你存储应用程序的位置。</p>\n<p>下载通常以带版本名称的目录进行，如 <code>twine_2.13</code> 或者 <code>pcgen-v6.07.04</code>。由于假设你将在某个时候更新应用程序，因此将版本号删除或创建目录的符号链接是个不错的主意。这样，即使你更新应用程序本身，为应用程序创建的启动程序也可以保持不变。</p>\n<p>要创建一个 <code>.desktop</code> 启动文件，打开一个文本编辑器并创建一个名为 <code>twine.desktop</code> 的文件。<a href=\"https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html\">桌面条目规范</a> 由 <a href=\"http://freedesktop.org\">FreeDesktop.org</a> 定义。下面是一个简单的启动器，用于一个名为 Twine 的游戏开发 IDE，安装在系统范围的 <code>/opt</code> 目录中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac191ed03c9c873168399\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[Desktop Entry]\r\nEncoding=UTF-8\r\nName=Twine\r\nGenericName=Twine\r\nComment=Twine\r\nExec=/opt/twine/Twine\r\nIcon=/usr/share/icons/oxygen/64x64/categories/applications-games.png\r\nTerminal=false\r\nType=Application\r\nCategories=Development;IDE;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c9c873168399-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03c9c873168399-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c9c873168399-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03c9c873168399-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c9c873168399-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03c9c873168399-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c9c873168399-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03c9c873168399-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c9c873168399-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03c9c873168399-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03c9c873168399-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac191ed03c9c873168399-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Desktop </span><span class=\"crayon-v\">Entry</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03c9c873168399-2\"><span class=\"crayon-v\">Encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">UTF</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">8</span></div><div class=\"crayon-line\" id=\"crayon-5ac191ed03c9c873168399-3\"><span class=\"crayon-v\">Name</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Twine</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03c9c873168399-4\"><span class=\"crayon-v\">GenericName</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Twine</span></div><div class=\"crayon-line\" id=\"crayon-5ac191ed03c9c873168399-5\"><span class=\"crayon-v\">Comment</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Twine</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03c9c873168399-6\"><span class=\"crayon-v\">Exec</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">twine</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">Twine</span></div><div class=\"crayon-line\" id=\"crayon-5ac191ed03c9c873168399-7\"><span class=\"crayon-v\">Icon</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">share</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">icons</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">oxygen</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">64x64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">categories</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">applications</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">games</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">png</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03c9c873168399-8\"><span class=\"crayon-v\">Terminal</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line\" id=\"crayon-5ac191ed03c9c873168399-9\"><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Application</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03c9c873168399-10\"><span class=\"crayon-v\">Categories</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">Development</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">IDE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5ac191ed03c9c873168399-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>棘手的一行是 <code>Exec</code> 行。它必须包含一个有效的命令来启动应用程序。通常，它只是你下载的东西的完整路径，但在某些情况下，它更复杂一些。例如，Java 应用程序可能需要作为 Java 自身的参数启动。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac191ed03ca2670604312\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nExec=java -jar /path/to/foo.jar\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03ca2670604312-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03ca2670604312-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac191ed03ca2670604312-1\"><span class=\"crayon-v\">Exec</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">java</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">jar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">jar</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03ca2670604312-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>有时，一个项目包含一个可以运行的包装脚本，这样你就不必找出正确的命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5ac191ed03ca8356595000\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nExec=/opt/foo/foo-launcher.sh\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5ac191ed03ca8356595000-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5ac191ed03ca8356595000-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5ac191ed03ca8356595000-1\"><span class=\"crayon-v\">Exec</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">foo</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">foo</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">launcher</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5ac191ed03ca8356595000-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在这个 Twine 例子中，没有与该下载的软件捆绑的图标，因此示例 <code>.desktop</code> 文件指定了 KDE 桌面附带的通用游戏图标。你可以使用类似的解决方法，但如果你更具艺术性，可以创建自己的图标，或者可以在 Internet 上搜索一个好的图标。只要 <code>Icon</code> 行指向一个有效的 PNG 或 SVG 文件，你的应用程序就会以该图标为代表。</p>\n<p>示例脚本还将应用程序类别主要设置为 Development，因此在 KDE、GNOME 和大多数其他应用程序菜单中，Twine 出现在开发类别下。</p>\n<p>为了让这个例子出现在应用程序菜单中，把 <code>twine.desktop</code> 文件放这到两个地方之一：</p>\n<ul>\n<li>如果你将应用程序存储在你自己的家目录下，那么请将其放在 <code>~/.local/share/applications</code>。</li>\n<li>如果你将应用程序存储在 <code>/opt</code> 目录或者其他系统范围的位置，并希望它出现在所有用户的应用程序菜单中，请将它放在 <code>/usr/share/applications</code> 目录中。</li>\n</ul>\n<p>现在，该应用程序已安装，因为它需要与系统的其他部分集成。</p>\n<h3 id=\"toc_8\">从源代码编译</h3>\n<p>最后，还有真正的通用格式安装格式：源代码。从源代码编译应用程序是学习如何构建应用程序，如何与系统交互以及如何定制应用程序的好方法。尽管如此，它绝不是一个点击按钮式过程。它需要一个构建环境，通常需要安装依赖库和头文件，有时还要进行一些调试。</p>\n<p>要了解更多关于从源代码编译的内容，请阅读<a href=\"https://opensource.com/article/17/10/open-source-cats\">我这篇文章</a>。</p>\n<h3 id=\"toc_9\">现在你明白了</h3>\n<p>有些人认为安装软件是一个神奇的过程，只有开发人员理解，或者他们认为它“激活”了应用程序，就好像二进制可执行文件在“安装”之前无效。学习许多不同的安装方法会告诉你安装实际上只是“将文件从一个地方复制到系统中适当位置”的简写。 没有什么神秘的。只要你去了解每次安装，不是期望应该如何发生，并且寻找开发者为安装过程设置了什么，那么通常很容易，即使它与你的习惯不同。</p>\n<p>重要的是安装器要诚实于你。 如果你遇到未经你的同意尝试安装其他软件的安装程序（或者它可能会以混淆或误导的方式请求同意），或者尝试在没有明显原因的情况下对系统执行检查，则不要继续安装。</p>\n<p>好的软件是灵活的、诚实的、开放的。 现在你知道如何在你的计算机上获得好软件了。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113793\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113793votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113793\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "url_object_id": "d750eaa333832623ef22835422172102"}